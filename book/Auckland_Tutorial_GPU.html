

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>EMRI Waveforms in a nutshell &#8212; EMRI Workshop</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'book/Auckland_Tutorial_GPU';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../Auckland_Tutorial_GPU.html">
  
  
  
  
  
  
    <p class="title logo__title">EMRI Workshop</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../Auckland_Tutorial_GPU.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">EMRI...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>-q<span class="w"> </span>condacolab
<span class="kn">import</span> <span class="nn">condacolab</span>
<span class="n">condacolab</span><span class="o">.</span><span class="n">install</span><span class="p">()</span>

<span class="o">!</span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/BlackHolePerturbationToolkit/FastEMRIWaveforms.git
<span class="o">!</span>conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>gcc_linux-64<span class="w"> </span>gxx_linux-64<span class="w"> </span>wget<span class="w"> </span>gsl<span class="w"> </span><span class="nv">lapack</span><span class="o">=</span><span class="m">3</span>.6.1<span class="w"> </span>hdf5<span class="w"> </span>numpy<span class="w"> </span>Cython<span class="w"> </span>scipy<span class="w"> </span>tqdm<span class="w"> </span>jupyter<span class="w"> </span>ipython<span class="w"> </span>h5py<span class="w"> </span>requests<span class="w"> </span>matplotlib<span class="w"> </span>python<span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>/dev/tty<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span>
<span class="o">!(</span><span class="nb">cd</span><span class="w"> </span>FastEMRIWaveforms<span class="p">;</span><span class="w"> </span>python<span class="w"> </span>setup.py<span class="w"> </span>install<span class="p">;</span><span class="o">)</span>

<span class="o">!</span>python<span class="w"> </span>-m<span class="w"> </span>unittest<span class="w"> </span>discover<span class="w"> </span>./FastEMRIWaveforms

<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;./FastEMRIWaveforms/&#39;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/usr/local/lib/python3.10/site-packages/few-1.5.4-py3.10-linux-x86_64.egg/&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">few</span>
<span class="kn">from</span> <span class="nn">few.trajectory.inspiral</span> <span class="kn">import</span> <span class="n">EMRIInspiral</span>
</pre></div>
</div>
</div>
</div>
<a target="_blank" href="https://colab.research.google.com/github/OllieBurke/EMRI_Workshop/blob/main/docs/Auckland_Tutorial_GPU.ipynb">
  <img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/>
</a>
<section class="tex2jax_ignore mathjax_ignore" id="emri-waveforms-in-a-nutshell">
<h1>EMRI Waveforms in a nutshell<a class="headerlink" href="#emri-waveforms-in-a-nutshell" title="Permalink to this heading">#</a></h1>
<p>Here you can find a pedagogical tutorial on creating Extreme Mass Ratio Inspiral (EMRI) waveforms. We will make an extensive use of the Fast EMRI Waveform (FEW) package <a class="reference external" href="https://arxiv.org/abs/2104.04582">arxiv.org/2104.04582</a> <a class="reference external" href="https://arxiv.org/abs/2008.06071">arxiv.org/2008.06071</a>. The waveforms in this package combine a variety of separately accessible modules to form EMRI waveforms on both CPUs and GPUs. Generally, the modules fall into four categories: trajectory, amplitudes, summation, and utilities. Please see the <a class="reference external" href="https://bhptoolkit.org/FastEMRIWaveforms/">documentation</a> for further information on these modules. The code and installation instructions can be found on Github <a class="reference external" href="https://github.com/BlackHolePerturbationToolkit/FastEMRIWaveforms">here</a>.</p>
<p>In this tutorial will cover the basics of EMRI waveforms. In particular, we will understand:</p>
<ol class="arabic simple">
<li><p>What is an Extreme Mass Ratio Inspiral?</p></li>
<li><p>How is an EMRI Waveform built? What are the parameters of an EMRI Waveform?</p></li>
<li><p>EMRI Trajectories</p></li>
<li><p>EMRI Waveforms in the time, frequency and time-frequency domains.</p></li>
</ol>
<section id="authors">
<h2>Authors<a class="headerlink" href="#authors" title="Permalink to this heading">#</a></h2>
<p>Lorenzo Speri: <a class="reference external" href="mailto:lorenzo&#46;speri&#37;&#52;&#48;aei&#46;mpg&#46;de">lorenzo<span>&#46;</span>speri<span>&#64;</span>aei<span>&#46;</span>mpg<span>&#46;</span>de</a> , <strong>Lorenzo wrote the original tutorial <a class="reference external" href="https://github.com/lorenzsp/GRAPPA_EMRI_tutorial">here</a></strong></p>
<p>Ollie Burke: <a class="reference external" href="mailto:ollie&#46;burke&#37;&#52;&#48;l2it&#46;in2p3&#46;fr">ollie<span>&#46;</span>burke<span>&#64;</span>l2it<span>&#46;</span>in2p3<span>&#46;</span>fr</a> , <strong>I have modified the tutorial to allow for GPU acceleration + more data analysis posed questions</strong></p>
</section>
<section id="what-is-an-extreme-mass-ratio-inspiral">
<h2>What is an Extreme Mass Ratio Inspiral?<a class="headerlink" href="#what-is-an-extreme-mass-ratio-inspiral" title="Permalink to this heading">#</a></h2>
<p>One of the primary sources for the future space-based gravitational wave detector, the Laser Interferometer Space Antenna, are the inspirals of small compact objects into massive black holes in the centers of galaxies. Such binaries are characterized by a small compact object of mass typically <span class="math notranslate nohighlight">\(\mu\in[1,100]M_\odot\)</span> (for example a solar-mass black hole or a neutron star) inspiralling around a Massive Black Hole (MBH) of mass <span class="math notranslate nohighlight">\(M\in[10^5,10^7]M_\odot\)</span>. Due to their particularly small mass ratio <span class="math notranslate nohighlight">\(\epsilon = \mu / M \sim [10^{-4},10^{-6}]\)</span> these systems are called Extreme Mass Ratio Inspiral (EMRI). Using perturbation theory in the mass ratio <span class="math notranslate nohighlight">\(\epsilon\)</span> it is possible to model the evolution of the orbit of the compact object. On short time-scales (order of the orbital period), the compact object moves on geodesic orbits as if it was a test particles. However, on longer time-scales, it is necessary to take into account the impact of the gravitational field of the compact object on the background and the gravitational wave emission. During the inspiral, the compact object is slowly driven away from geodesic orbits and this deviation can be interpreted as an effective acceleration/force due to the so-called Gravitational <a class="reference external" href="https://arxiv.org/abs/1805.10385">Self-Force</a>.</p>
<p>Below, in the left panel, we show an example of a small compact object of ten solar masses inspiraling around a spinning MBH of <span class="math notranslate nohighlight">\(10^6\)</span> solar masses. The duration of the animation corresponds to 25 hours. In the right panel, you can see the gravitational wave signal emmitted during this inspirals. After you complete this tutorial you will easily be able to build animations like the ones above! If you want to impress your family, friends and possible pets, <a class="reference external" href="https://github.com/OllieBurke/animations.git">click this link</a></p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p>[Building Trajectories]</p></th>
<th class="head text-center"><p>[Building Waveforms]</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p><a class="reference external" href="https://github.com/OllieBurke/EMRI_Workshop/blob/main/docs/movies/trajectory.gif?raw=true"><img alt="" src="https://github.com/OllieBurke/EMRI_Workshop/blob/main/docs/movies/trajectory.gif?raw=true" /></a></p></td>
<td class="text-center"><p><a class="reference external" href="https://github.com/OllieBurke/EMRI_Workshop/blob/main/docs/movies/waveform.gif?raw=true"><img alt="" src="https://github.com/OllieBurke/EMRI_Workshop/blob/main/docs/movies/waveform.gif?raw=true" /></a></p></td>
</tr>
</tbody>
</table>
</section>
<section id="emri-waveforms">
<h2>EMRI Waveforms<a class="headerlink" href="#emri-waveforms" title="Permalink to this heading">#</a></h2>
<p>EMRI waveforms are represented by the complex time-domain dimensionless strain <span class="math notranslate nohighlight">\(h(t) = h_+ - ih_\times\)</span>, where <span class="math notranslate nohighlight">\(h_+\)</span> and <span class="math notranslate nohighlight">\(h_\times\)</span> are the usual transverse-traceless gravitational wave polarizations. For large distances from the source (<span class="math notranslate nohighlight">\(d_{L}\rightarrow \infty\)</span>), <span class="math notranslate nohighlight">\(h\)</span> is given in the source frame by:</p>
<div class="math notranslate nohighlight">
\[
    h = \frac{\mu}{d_L}\sum_{lmkn} A_{lmkn}(t) \, S_{lmkn}(\theta,\phi) \, \exp(-i\Phi_{mkn}(t)).
\]</div>
<p>Here <span class="math notranslate nohighlight">\(\mu\)</span> is the mass of the secondary body, <span class="math notranslate nohighlight">\(d_{L}\)</span> the luminosity distance to the source, <span class="math notranslate nohighlight">\(t\)</span> is the time of arrival of the gravitational wave at the solar system baricenter, and <span class="math notranslate nohighlight">\((l,m,k,n)\)</span> are the indices describing the frequency-domain harmonic mode decomposition (or simply “harmonic” or “mode”):</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(l\)</span> denotes the orbital angular momentum mode index and can take the value <span class="math notranslate nohighlight">\(l=2,3,...\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(m\)</span> denotes the azimuthal mode index and can take the values from <span class="math notranslate nohighlight">\(-l\)</span> up to <span class="math notranslate nohighlight">\(l\)</span>. For example for l=2, <span class="math notranslate nohighlight">\(m=-2, -1, 0, 1, 2\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(k\)</span> and <span class="math notranslate nohighlight">\(n\)</span> denote the polar and radial mode indices and can take values from <span class="math notranslate nohighlight">\(-\infty\)</span> up to <span class="math notranslate nohighlight">\(+\infty\)</span>. But in practice they are restriced to values around zero, for instance between <span class="math notranslate nohighlight">\(-30\)</span> up to <span class="math notranslate nohighlight">\(30\)</span>. In this tutorial there will be no <span class="math notranslate nohighlight">\(k\)</span> modes since our inspirals are restricted to the equatorial plane of the central hole.</p></li>
</ul>
<p>For LIGO sources, where the two objects have comparable masses, the strongest mode is the <span class="math notranslate nohighlight">\((l=2,m=2,k=0,n=0)\)</span>.
See <a class="reference external" href="https://arxiv.org/abs/gr-qc/0509101">Drasco and Hughes 2006</a> and <a class="reference external" href="https://arxiv.org/pdf/2102.02713.pdf">Hughes+ 2021</a> for a derivation of the gravitational waveform.</p>
<section id="each-harmonic-is-characterized-by-three-important-functions">
<h3>Each harmonic is characterized by three important functions:<a class="headerlink" href="#each-harmonic-is-characterized-by-three-important-functions" title="Permalink to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>The oscillatory part <span class="math notranslate nohighlight">\(\exp[-i\Phi_{mkn}(t)]\)</span> is determined by the phase <span class="math notranslate nohighlight">\(\Phi_{mkn}=m\Phi_\varphi + k \Phi_\theta + n\Phi_r\)</span>. The phases <span class="math notranslate nohighlight">\(\Phi_{\varphi,\theta,r}\)</span> are determined solving for the EMRI trajectory, i.e. the following system of ordinary differential equations:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
    \frac{d}{dt}p = \epsilon \, f^{(1)}_p(a, p, e, x_I) + \mathcal{O}(\epsilon^2) \]</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$$\frac{d}{dt}e = \epsilon \, f^{(1)}_e(a, p, e, x_I) + \mathcal{O}(\epsilon^2) $$
$$\frac{d}{dt}x_I = \epsilon \, f^{(0)}_{x_I}(a, p, e, x_I) + \mathcal{O}(\epsilon^2)$$
</pre></div>
</div>
<div class="math notranslate nohighlight">
\[\frac{d}{dt}\Phi_{\varphi,\theta,r} = \Omega_{\varphi, \theta, r}(a, p, e, x_I)/M + \mathcal{O}(\epsilon)
\]</div>
<p>with initial condition <span class="math notranslate nohighlight">\(\{\Phi_{\varphi0},\Phi_{\theta0},\Phi_{r0},p_0,e_0,x_{I0}\}\)</span>. The frequencies <span class="math notranslate nohighlight">\(\Omega_{r,\theta,\phi}\)</span> describe the fundamental frequencies of a Kerr geodesic orbit and in the Newtonian limit (weak field) they all converge to the Keplerian frequency. These frequencies are determined using the dimensionless spin of the MBH, <span class="math notranslate nohighlight">\(a\)</span>, and the quasi-Keplerian orbital parameters of <span class="math notranslate nohighlight">\(p\)</span> (semi-latus rectum; hereafter separation), <span class="math notranslate nohighlight">\(e\)</span> (eccentricity), and <span class="math notranslate nohighlight">\(\cos{I} \equiv x_I\)</span> (cosine of the angle <span class="math notranslate nohighlight">\(I\)</span> which describes the orbit’s inclination from the equatorial plane). The rate of change of <span class="math notranslate nohighlight">\(p,e,x_I\)</span> (left hand side of the first 3 equations) is obtained using the orbital-element fluxes <span class="math notranslate nohighlight">\(f_{p,e,x_I}\)</span>, which account for the gravitational wave emission, and the mass ratio <span class="math notranslate nohighlight">\(\epsilon = \mu/M\)</span>. For <span class="math notranslate nohighlight">\(\epsilon \rightarrow 0\)</span> we reach the test-particle limit, and the orbital elements do not vay over time. The extra contributions due to second order in the mass-ratio squared arise from the second-order self force, which is currently a very active field of research. For more information, see <a class="reference external" href="https://arxiv.org/abs/1805.10385">Barack and Pound</a>.</p>
<ol class="arabic simple" start="2">
<li><p>The amplitude <span class="math notranslate nohighlight">\(A_{lmkn}(t)\)</span> which quantifies the size of each harmonic <span class="math notranslate nohighlight">\((l,m,k,n)\)</span>. These are determined using the orbital parameters <span class="math notranslate nohighlight">\(A_{lmkn}(p(t), e(t), x_I(t))\)</span>. See in the plot below that orbits with higher eccentricity <span class="math notranslate nohighlight">\(e_{0} = 0.7\)</span> require significantly many more harmonics than orbits with lower eccentricity <span class="math notranslate nohighlight">\(e_{0} = 0.1\)</span>. In each plot, the semi-latus rectum has been fixed to <span class="math notranslate nohighlight">\(p_{0} = 10\)</span> and <span class="math notranslate nohighlight">\(x_{I} = \cos(\iota_{0}) = 0.5\)</span>.</p></li>
<li><p>The angular function <span class="math notranslate nohighlight">\(S_{lmkn}(\theta,\phi)\)</span> which describes how the amplitude is modulated depending on the source-frame polar viewing angle <span class="math notranslate nohighlight">\(\theta\)</span>, the source-frame azimuthal viewing angle <span class="math notranslate nohighlight">\(\phi\)</span>. For Schwarzchild black holes these functions reduce to the -2 spin weighted spherical harmonics <span class="math notranslate nohighlight">\(Y_{lm}\)</span>.</p></li>
</ol>
<p><img alt="" src="https://github.com/OllieBurke/EMRI_Workshop/blob/main/docs/images/amplitude.jpg?raw=true" /></p>
</section>
<section id="general-remarks">
<h3>General Remarks<a class="headerlink" href="#general-remarks" title="Permalink to this heading">#</a></h3>
<p>Notice the correspondence of the mode index with the three different degrees of freedom: <span class="math notranslate nohighlight">\(m\rightarrow \varphi\)</span> (azimuthal), <span class="math notranslate nohighlight">\(k\rightarrow \theta\)</span> (polar), <span class="math notranslate nohighlight">\(n\rightarrow r\)</span> (radial). Each mode is characterized by the mode frequency <span class="math notranslate nohighlight">\(\omega_{mkn}=m\Omega_\varphi + k \Omega_\theta + n \Omega_r\)</span> which is the derivative of the phase <span class="math notranslate nohighlight">\(\Phi_{mkn}\)</span>. On short time-scales, the gravitational wave of an EMRI can be thought as a Fourier series with coefficients <span class="math notranslate nohighlight">\(\sum_l A_{lmnk} S_{lmkn}\)</span> and frequencies <span class="math notranslate nohighlight">\(\omega_{mkn}\)</span>. The quantities <span class="math notranslate nohighlight">\(\Omega_{\varphi, \theta, r}\)</span> are fundamental frequencies in the azimuthal, polar and radial coordinates:  <span class="math notranslate nohighlight">\((\varphi, \theta, r)\)</span>.</p>
<p>Theoretical parameter ranges:</p>
<ul class="simple">
<li><p>the eccentricity ranges between 0 and 1, for <span class="math notranslate nohighlight">\(e=0\)</span> the orbits are circular;</p></li>
<li><p>the inclination parameter ranges between -1 and 1, for <span class="math notranslate nohighlight">\(x_I=1\)</span> the orbits are equatorial prograde, <span class="math notranslate nohighlight">\(x_I=-1\)</span> the orbits are equatorial retrograde, <span class="math notranslate nohighlight">\(x_I=0\)</span> the orbits are polar. An orbit is pro(retro)grade only if the trajectory of the body is (anti)aligned with the massive compact objects orbital angular momentum.</p></li>
<li><p>the dimensionless spin parameters ranges between 0 and 1, for <span class="math notranslate nohighlight">\(a=0\)</span> the central MBH is not spinning (Schwarzchild background) and the orbit of the compact object stays in the same plane, i.e. <span class="math notranslate nohighlight">\(x_I\)</span> is constant.</p></li>
</ul>
<p>See <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2021PhRvD.103j4014H/abstract">Hughes+ 2021</a> for further discussion and more detailed definitions.</p>
</section>
</section>
<section id="emri-parameter-space">
<h2>EMRI Parameter space<a class="headerlink" href="#emri-parameter-space" title="Permalink to this heading">#</a></h2>
<p>After we outlined the building blocks to create an EMRI waveform, let us now understand how these are organized in the Fast EMRI Waveform code. The waveform code takes as input two sets of parameters:</p>
<ul class="simple">
<li><p>The intrinsic parameters <span class="math notranslate nohighlight">\((M,\mu,a,p_0,e_0,(x_{I})_0,\Phi_{\varphi 0},\Phi_{\theta 0},\Phi_{r 0})\)</span>, which are used to construct the waveform in the source frame; Notice that the last six parameters here serve as initial conditions for the coupled set of ODEs defined earlier, with <span class="math notranslate nohighlight">\(M\)</span> and <span class="math notranslate nohighlight">\(\mu\)</span> determining the most crucial feature of the EMRI: The mass ratio <span class="math notranslate nohighlight">\(\epsilon = \mu/M\)</span>. The intrinsic parameters govern the evolution of the signal as a function of frequency.</p></li>
<li><p>the extrinsic parameters <span class="math notranslate nohighlight">\((d_L,\theta_S,\phi_S,\theta_K,\phi_K)\)</span>, which define how the waveform is viewed in a given reference frame. The extrinsic parameters feature more in the amplitude of the waveform.</p></li>
</ul>
<p>The intrinsic parameters are then passed into the trajectory module which computes the sparse time evolution of the phases <span class="math notranslate nohighlight">\(\Phi_{\varphi}(t),\Phi_{\theta}(t),\Phi_{r}(t)\)</span> and orbital elements <span class="math notranslate nohighlight">\(p(t),e(t),x_I(t)\)</span>. The phases are used to assemble the oscillatory part, whereas the orbital elements are passed to the amplitude module which computes <span class="math notranslate nohighlight">\(A(p(t),e(t),x_I(t))\)</span>. The angular function is computed using the extrinsic parameters. Then the summation module (Waveform build) takes as input the functions <span class="math notranslate nohighlight">\(\exp[-i\Phi_{mkn}(t)], A_{lmkn}(t)\)</span> and <span class="math notranslate nohighlight">\(S_{lmkn}(\theta,\phi)\)</span> and outputs the waveform strain <span class="math notranslate nohighlight">\(h\)</span>.</p>
<p><img alt="FEW_arch" src="https://github.com/OllieBurke/EMRI_Workshop/blob/main/docs/images/FEW_arch.jpg?raw=true" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we import here all the modules and packages we need</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cupy</span> <span class="k">as</span> <span class="nn">cp</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span> <span class="k">as</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">few.trajectory.inspiral</span> <span class="kn">import</span> <span class="n">EMRIInspiral</span>
<span class="kn">from</span> <span class="nn">few.amplitude.romannet</span> <span class="kn">import</span> <span class="n">RomanAmplitude</span>
<span class="kn">from</span> <span class="nn">few.amplitude.interp2dcubicspline</span> <span class="kn">import</span> <span class="n">Interp2DAmplitude</span>
<span class="kn">from</span> <span class="nn">few.waveform</span> <span class="kn">import</span> <span class="n">FastSchwarzschildEccentricFlux</span><span class="p">,</span> <span class="n">SlowSchwarzschildEccentricFlux</span><span class="p">,</span> <span class="n">GenerateEMRIWaveform</span>
<span class="kn">from</span> <span class="nn">few.utils.utility</span> <span class="kn">import</span> <span class="p">(</span><span class="n">get_overlap</span><span class="p">,</span>
                               <span class="n">get_mismatch</span><span class="p">,</span>
                               <span class="n">get_fundamental_frequencies</span><span class="p">,</span>
                               <span class="n">get_separatrix</span><span class="p">,</span>
                               <span class="n">get_mu_at_t</span><span class="p">,</span>
                               <span class="n">get_p_at_t</span><span class="p">,</span>
                               <span class="n">get_kerr_geo_constants_of_motion</span><span class="p">,</span>
                               <span class="n">xI_to_Y</span><span class="p">,</span>
                               <span class="n">Y_to_xI</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">few.utils.ylm</span> <span class="kn">import</span> <span class="n">GetYlms</span>
<span class="kn">from</span> <span class="nn">few.utils.modeselector</span> <span class="kn">import</span> <span class="n">ModeSelector</span>
<span class="kn">from</span> <span class="nn">few.summation.interpolatedmodesum</span> <span class="kn">import</span> <span class="n">CubicSplineInterpolant</span>
<span class="kn">from</span> <span class="nn">few.waveform</span> <span class="kn">import</span> <span class="n">SchwarzschildEccentricWaveformBase</span>
<span class="kn">from</span> <span class="nn">few.summation.interpolatedmodesum</span> <span class="kn">import</span> <span class="n">InterpolatedModeSum</span>
<span class="kn">from</span> <span class="nn">few.summation.directmodesum</span> <span class="kn">import</span> <span class="n">DirectModeSum</span>
<span class="kn">from</span> <span class="nn">few.utils.constants</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">few.summation.aakwave</span> <span class="kn">import</span> <span class="n">AAKSummation</span>
<span class="kn">from</span> <span class="nn">few.waveform</span> <span class="kn">import</span> <span class="n">Pn5AAKWaveform</span><span class="p">,</span> <span class="n">AAKWaveformBase</span>

<span class="n">use_gpu</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># keyword arguments for inspiral generator (RunSchwarzEccFluxInspiral)</span>
<span class="n">inspiral_kwargs</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;DENSE_STEPPING&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># we want a sparsely sampled trajectory</span>
        <span class="s2">&quot;max_init_len&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e3</span><span class="p">),</span>  <span class="c1"># all of the trajectories will be well under len = 1000</span>
    <span class="p">}</span>

<span class="c1"># keyword arguments for inspiral generator (RomanAmplitude)</span>
<span class="n">amplitude_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;max_init_len&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e3</span><span class="p">),</span>  <span class="c1"># all of the trajectories will be well under len = 1000</span>
    <span class="s2">&quot;use_gpu&quot;</span><span class="p">:</span> <span class="n">use_gpu</span>  <span class="c1"># GPU is available in this class</span>
<span class="p">}</span>

<span class="c1"># keyword arguments for Ylm generator (GetYlms)</span>
<span class="n">Ylm_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;assume_positive_m&quot;</span><span class="p">:</span> <span class="kc">False</span>  <span class="c1"># if we assume positive m, it will generate negative m for all m&gt;0</span>
<span class="p">}</span>

<span class="c1"># keyword arguments for summation generator (InterpolatedModeSum)</span>
<span class="n">sum_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;use_gpu&quot;</span><span class="p">:</span> <span class="n">use_gpu</span><span class="p">,</span>  <span class="c1"># GPU is availabel for this type of summation</span>
    <span class="s2">&quot;pad_output&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="schwarzschild-eccentric-trajectories-and-waveforms">
<h2>Schwarzschild Eccentric Trajectories and Waveforms<a class="headerlink" href="#schwarzschild-eccentric-trajectories-and-waveforms" title="Permalink to this heading">#</a></h2>
<p>In this tutorial we will restrict to EMRI systems in which the central object is a non-spinning black hole. The case of a spinning black hole is presented at the end of the notebook in the additional materials.</p>
</section>
<section id="trajectory-module">
<h2>Trajectory Module<a class="headerlink" href="#trajectory-module" title="Permalink to this heading">#</a></h2>
<p>The trajectory module generates orbital <span class="math notranslate nohighlight">\(\{p(t),e(t), x_{I}(t)\}\)</span> and phase <span class="math notranslate nohighlight">\(\{\Phi_\varphi(t), \Phi_\theta(t), \Phi_r(t)\}\)</span> trajectories for an EMRI orbit defined by the coordinate-time evolving quantities:</p>
<div class="math notranslate nohighlight">
\[
p(t), e(t), x_I(t), \Phi_\varphi(t), \Phi_\theta(t), \Phi_r(t)
\]</div>
<p>with initial inputs <span class="math notranslate nohighlight">\(M, \mu, p_0, e_0, (x_{I})_{0}, \iota_0, \Phi_{\varphi0}, \Phi_{\theta0}, \Phi_{r 0}\)</span>. We remark here that <span class="math notranslate nohighlight">\(x_{I} = \cos(\iota (t))\)</span> for <span class="math notranslate nohighlight">\(\iota\)</span> the inclination angle of the body with respect to the equatorial plane (see image below). The trajectory is evolved for a user defined time of <span class="math notranslate nohighlight">\(T\)</span> years or until the last-stable orbit, defined by the separatrix <span class="math notranslate nohighlight">\(p_{sep}\)</span> is reached. If the specified duration <span class="math notranslate nohighlight">\(T\)</span> is longer than the time taken to reach the separatrix, then the orbit will terminate at <span class="math notranslate nohighlight">\(p(t_{\text{sep}}) = p_{\text{sep}}\)</span>. At a single point in time, the orbit can be pictures like</p>
<div style="text-align:center;">
<img src="https://github.com/OllieBurke/EMRI_Workshop/blob/main/docs/images/Orbit.jpg?raw=true" width="700" height="700">
</div>
<p><span class="math notranslate nohighlight">\(M\)</span> is the larger mass (<span class="math notranslate nohighlight">\(M_\odot\)</span>), <span class="math notranslate nohighlight">\(\mu\)</span> is the compact object mass (<span class="math notranslate nohighlight">\(M_\odot\)</span>), <span class="math notranslate nohighlight">\(p_0\)</span> is the initial semi-latus rectum (dimensionless), <span class="math notranslate nohighlight">\(e_0\)</span> is the initial eccentricity (dimensionless), and the final three are the initial orbital phases <span class="math notranslate nohighlight">\(\Phi_{\varphi 0}, \Phi_{\theta 0}, \Phi_{r 0}\)</span> (in radians). The three orbital phases can be thought of as “positional elements” of the smaller body when in orbit of the primary black hole. Take, for example, a sphere of radius <span class="math notranslate nohighlight">\(r\)</span>. There are infinitely many points on that sphere for where that radius could be defined. However, only by fixing the angular variables in <span class="math notranslate nohighlight">\(\theta\)</span> and <span class="math notranslate nohighlight">\(\phi\)</span> can you define a specific point on a sphere with spherical polar coordinates <span class="math notranslate nohighlight">\((r,\theta,\phi)\)</span>. It’s similar for the EMRI orbit. If you specify a specific orbital parameters <span class="math notranslate nohighlight">\(p_{0},e_{0},(x_{I})_{0}\)</span> then we need phase variables <span class="math notranslate nohighlight">\(\Phi_{\varphi 0,\theta 0,\phi 0}\)</span> to determine the smaller bodies position with respect to the central massive black hole.</p>
<p>For the special case of non-rotating black holes (Schwarzchild black holes) the spin parameter is zero <span class="math notranslate nohighlight">\(a=0\)</span>. This will simplify the orbit where the body necessarily remains on the same plane <span class="math notranslate nohighlight">\(x_I=1\)</span>, and the separatrix is located at <span class="math notranslate nohighlight">\(p_\textrm{sep} = 6+2e\)</span>. Given that <span class="math notranslate nohighlight">\(p(t)\)</span> and <span class="math notranslate nohighlight">\(e(t)\)</span> are time-evolving quantities, the separatrix will also be evolving in time. For further details on the location of the separatrix for generic orbits around rotating black holes (and various special cases), see <a class="reference external" href="https://arxiv.org/pdf/1912.07609.pdf">Stein and Warburton</a> for an excellent discussion.</p>
<section id="let-us-begin-by-analysing-a-basic-trajectory">
<h3>Let us begin by analysing a basic trajectory<a class="headerlink" href="#let-us-begin-by-analysing-a-basic-trajectory" title="Permalink to this heading">#</a></h3>
<p>We begin by analysing eccentric orbits in a Schwarzschild space-time. This means that <span class="math notranslate nohighlight">\(a = 0, x_{I}(t) = 1, \Phi_{\theta0} = 0\)</span> will be fixed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialize trajectory class</span>
<span class="n">traj</span> <span class="o">=</span> <span class="n">EMRIInspiral</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="s2">&quot;SchwarzEccFlux&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set initial parameters for Schwarzschild orbit</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>   <span class="c1"># Primary mass  (solar masses)</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>  <span class="c1"># Secondary mass  (solar masses)</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1"># range [separatrix, 45]</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span>  <span class="c1"># range [0.0, 0.7]</span>

<span class="c1"># run trajectory</span>
<span class="c1"># must include for generic inputs, will fix a = 0 and x = 1.0</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1"># additional information</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="c1"># initial time step,</span>
              <span class="n">T</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="c1"># Time duration in years</span>
              <span class="n">err</span><span class="o">=</span><span class="mf">1e-10</span> <span class="c1"># integrator error -- used as a tolerance to solve coupled ODEs above</span>
             <span class="p">)</span>

<span class="c1"># Compute trajectory of smaller body: p(t), e(t), xI(t), Phi_phi(t), Phi_theta(t), Phi_r(t)</span>
<span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">xI</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">,</span> <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
                                              <span class="n">Phi_phi0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_theta0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_r0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="c1"># get dimensionless fundamental frequencies</span>
<span class="n">OmegaPhi</span><span class="p">,</span> <span class="n">OmegaTheta</span><span class="p">,</span> <span class="n">OmegaR</span> <span class="o">=</span> <span class="n">get_fundamental_frequencies</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>


<span class="c1"># Plot the results</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$e$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$p$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$e$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Phi_\phi$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Phi_r$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Omega_\phi$&#39;</span><span class="p">]</span>
<span class="n">xlabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$p$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$ [years]&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$ [years]&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$ [years]&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$ [years]&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$ [years]&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$ [years]&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$ [years]&#39;</span><span class="p">]</span>
<span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_r</span><span class="p">,</span> <span class="n">OmegaPhi</span><span class="p">]</span>
<span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">,</span> <span class="n">t</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">,</span> <span class="n">t</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">,</span> <span class="n">t</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">,</span> <span class="n">t</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xlab</span><span class="p">,</span> <span class="n">ylab</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">xlabels</span><span class="p">,</span> <span class="n">ylabels</span><span class="p">)):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlab</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylab</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="exercise-0">
<h2>Exercise 0<a class="headerlink" href="#exercise-0" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>For the default parameters <span class="math notranslate nohighlight">\((M,\mu,a,p_{0},e_{0},(x_{I})_{0}) = (10^{6}, 10, 0, 10, 0.3, 1)\)</span> with <span class="math notranslate nohighlight">\(T = 2\)</span> years, verify that the final point in semi-latus rectum corresponds to the separatrix defined by <span class="math notranslate nohighlight">\(p = 6 + 2e\)</span>. Change the time of evolution <span class="math notranslate nohighlight">\(T\)</span> and make a note of what you find.</p></li>
<li><p>Modify the mass-ratio of the system above by increasing/decreasing <span class="math notranslate nohighlight">\(M\)</span> whilst keeping <span class="math notranslate nohighlight">\(\mu\)</span> (and all other parameters) fixed. What do you observe about the orbital evolution in semi-latus rectum <span class="math notranslate nohighlight">\(p(t)\)</span>? You may need to increase the time of evolution <span class="math notranslate nohighlight">\(T\)</span>. You will find that <span class="math notranslate nohighlight">\(\dot{p} = dp/dt\)</span> decreases as <span class="math notranslate nohighlight">\(M\)</span> is increased.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># EXERCISE 0!</span>

<span class="c1"># set initial parameters for Schwarzschild orbit</span>
<span class="c1"># M = 1e6   # Primary mass  (solar masses)</span>
<span class="c1"># mu = 1e1  # Secondary mass  (solar masses)</span>
<span class="c1"># p0 = 10.0 # range [separatrix, 45]</span>
<span class="c1"># e0 = 0.3  # range [0.0, 0.7]</span>

<span class="c1"># # run trajectory</span>
<span class="c1"># # must include for generic inputs, will fix a = 0 and x = 1.0</span>
<span class="c1"># a = 0.0</span>
<span class="c1"># x = 1.0</span>

<span class="c1"># # additional information</span>
<span class="c1"># kwargs = dict(dt=10.0, # initial time step,</span>
<span class="c1">#               T=2.0, # Time duration in years</span>
<span class="c1">#               err=1e-10 # integrator error -- used as a tolerance to solve coupled ODEs above</span>
<span class="c1">#              )</span>

<span class="c1"># # Compute trajectory of smaller body: p(t), e(t), xI(t), Phi_phi(t), Phi_theta(t), Phi_r(t)</span>
<span class="c1"># t, p, e, xI, Phi_phi, Phi_theta, Phi_r = traj(M, mu, a, p0, e0, x,</span>
<span class="c1">#                                               Phi_phi0=0.0,</span>
<span class="c1">#                                               Phi_theta0=0.0,</span>
<span class="c1">#                                               Phi_r0=0.0,</span>
<span class="c1">#                                               **kwargs)</span>

<span class="c1"># p_sep = [INSERT YOUR CODE HERE]</span>
<span class="c1"># print(&quot;Separatrix is at &quot;,p_sep)</span>
<span class="c1"># print(&quot;Final point in semi-latus rectum is&quot;, p[-1])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># EXERCISE 0!</span>

<span class="c1"># set initial parameters for Schwarzschild orbit</span>

<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>  <span class="c1"># Secondary mass  (solar masses)</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1"># range [separatrix, 45]</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span>  <span class="c1"># range [0.0, 0.7]</span>

<span class="c1"># run trajectory</span>
<span class="c1"># must include for generic inputs, will fix a = 0 and x = 1.0</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1"># additional information</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="c1"># initial time step,</span>
              <span class="n">T</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="c1"># Time duration in years</span>
              <span class="n">err</span><span class="o">=</span><span class="mf">1e-10</span> <span class="c1"># integrator error -- used as a tolerance to solve coupled ODEs above</span>
             <span class="p">)</span>

<span class="c1"># Compute trajectory of smaller body: p(t), e(t), xI(t), Phi_phi(t), Phi_theta(t), Phi_r(t)</span>

<span class="c1"># M_vec = 10**np.arange(4,7,1)</span>
<span class="c1"># N_plots = len(M_vec)</span>

<span class="c1"># fig,ax = plt.subplots(1,N_plots, figsize = (12,4))</span>
<span class="c1"># i=0</span>
<span class="c1"># for M in M_vec:</span>
<span class="c1">#     t, p, e, xI, Phi_phi, Phi_theta, Phi_r = [INSERT YOUR CODE HERE]</span>

<span class="c1">#     ax[i].plot(t/60/60/24,p,label = &quot;M = {}&quot;.format(M))</span>
<span class="c1">#     ax[i].set_xlabel(r&#39;time [days]&#39;, fontsize = 18)</span>
<span class="c1">#     ax[i].set_ylabel(r&#39;semi-latus rectum $p$&#39;,fontsize = 18)</span>
<span class="c1">#     ax[i].set_title(r&#39;Primary mass = {} $M_\odot$&#39;.format(M),fontsize = 14)</span>
<span class="c1">#     ax[i].legend()</span>
<span class="c1">#     ax[i].grid()</span>


<span class="c1">#     i+=1</span>
</pre></div>
</div>
</div>
</div>
<section id="quasi-keplerian-parameters-p-e">
<h3>Quasi-Keplerian parameters: <span class="math notranslate nohighlight">\((p,e)\)</span><a class="headerlink" href="#quasi-keplerian-parameters-p-e" title="Permalink to this heading">#</a></h3>
<p>We want to remark that <span class="math notranslate nohighlight">\(p\)</span> and <span class="math notranslate nohighlight">\(e\)</span> are quasi-Keplerian parameters and gauge dependent quantities (they depend on the choice of coordinate system). They “converge” to the Newtonian equivalent parameters in the weak field regime (far away in radial coordinate <span class="math notranslate nohighlight">\(r\)</span> from the black hole). Below we show a plot of ellipsis based on these parameters at diferent stages of the evolution. This is useful to get a sense of the evolution of the orbit but you should not interpret these ellipsis as real orbits!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set initial parameters for Schwarzschild orbit</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>   <span class="c1"># Primary mass  (solar masses)</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>  <span class="c1"># Secondary mass  (solar masses)</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.5</span> <span class="c1"># range [separatrix, 45]</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span>  <span class="c1"># range [0.0, 0.7]</span>

<span class="c1"># run trajectory</span>
<span class="c1"># must include for generic inputs, will fix a = 0 and x = 1.0</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1"># additional information</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="c1"># initial time step,</span>
              <span class="n">T</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="c1"># Time duration in years</span>
              <span class="n">err</span><span class="o">=</span><span class="mf">1e-10</span> <span class="c1"># integrator error -- used as a tolerance to solve coupled ODEs above</span>
             <span class="p">)</span>

<span class="c1"># Compute trajectory of smaller body: p(t), e(t), xI(t), Phi_phi(t), Phi_theta(t), Phi_r(t)</span>
<span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">xI</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">,</span> <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
                                              <span class="n">Phi_phi0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_theta0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_r0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;Spectral&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="mi">12</span><span class="p">):</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
    <span class="n">ee</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
    <span class="n">Csi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">rr</span> <span class="o">=</span> <span class="n">pp</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">ee</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Csi</span><span class="p">))</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">rr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Csi</span><span class="p">)</span>
    <span class="n">yy</span> <span class="o">=</span> <span class="n">rr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Csi</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">ii</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)),</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;time = </span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">YRSID_SI</span><span class="p">)</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1"> years&#39;</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;MBH&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$r\cos(\xi)$&#39;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$r\sin(\xi)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Illustrative depiction of orbits&#39;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="evolution-of-semi-latus-rectum-and-eccentricity">
<h2>Evolution of semi-latus rectum and eccentricity<a class="headerlink" href="#evolution-of-semi-latus-rectum-and-eccentricity" title="Permalink to this heading">#</a></h2>
<p>The goal of the next cell is to understand how the semi-latus rectum and eccentricity evolve together. Notice that for trajectories with semi-latus rectum close to the separatrix, one observes an “uptick” in the eccentricity. This is a well known feature and is further discussed in this <a class="reference external" href="https://arxiv.org/abs/gr-qc/0203086">article</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>     <span class="c1"># Primary mass (solar masses)</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>    <span class="c1"># Secondary mass (solar masses)</span>

<span class="c1"># run trajectory</span>

<span class="c1"># must include for generic inputs, will fix a = 0 and x = 1.0</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1"># additional information</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="c1"># initial time step,</span>
              <span class="n">T</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="c1"># Time duration in years [Excessive, but want to evolve to separatrix! here]</span>
              <span class="n">err</span><span class="o">=</span><span class="mf">1e-10</span> <span class="c1"># integrator error</span>
             <span class="p">)</span>

<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1"># range [separatrix, 45]</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c1"># range [0.0, 0.7]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>


<span class="c1"># Here we plot the trajectory with all parameters fixed (e0 = 0.7) apart from p0</span>
<span class="k">for</span> <span class="n">p0</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">e0</span><span class="o">=</span><span class="mf">0.7</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">xI</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">,</span> <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
                                              <span class="n">Phi_phi0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_theta0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_r0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">e</span><span class="p">)</span>

<span class="c1"># Now we plot the trajectory with all parameters fixed (p0 = 20) apart from e0</span>
<span class="k">for</span> <span class="n">e0</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.69</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">p0</span><span class="o">=</span><span class="mf">20.0</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">xI</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">,</span> <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
                                              <span class="n">Phi_phi0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_theta0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_r0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">e</span><span class="p">)</span>

<span class="c1"># Separatrix given by p_sep = 6 + 2*e</span>
<span class="n">pp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mf">7.5</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ecc</span> <span class="o">=</span> <span class="p">(</span><span class="n">pp</span> <span class="o">-</span> <span class="mi">6</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span><span class="n">ecc</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;separatrix&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="trajectory-duration-as-a-function-of-mass-ratio-eccentricity-semi-latus-rectum">
<h3>Trajectory duration as a function of mass ratio, eccentricity, semi-latus rectum<a class="headerlink" href="#trajectory-duration-as-a-function-of-mass-ratio-eccentricity-semi-latus-rectum" title="Permalink to this heading">#</a></h3>
<p>In Exercise 0 above we saw that the length of the trajectory, in time, is very sensitive to the mass-ratio of the system. The coupled ODEs</p>
<div class="math notranslate nohighlight">
\[
\frac{d}{dt}p = \epsilon \, f^{(1)}_p(a, p, e, x_I) + \mathcal{O}(\epsilon^2)
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{d}{dt}e = \epsilon \, f^{(1)}_e(a, p, e, x_I) + \mathcal{O}(\epsilon^2)
\]</div>
<p>show that <span class="math notranslate nohighlight">\(\dot{p} \sim \dot{e} \sim \epsilon\)</span>. It should then be expected that the rate of change of the orbital parameters <span class="math notranslate nohighlight">\(p(t)\)</span> and <span class="math notranslate nohighlight">\(e(t)\)</span> is directly proportional to the size of the mass-ratio of the system. We will investigate this below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>   <span class="c1"># Primary mass</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>  <span class="c1"># Secondary mass</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mi">12</span> <span class="c1"># range [separatrix, 45]</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c1"># range [0.0, 0.7]</span>

<span class="c1"># run trajectory</span>

<span class="c1"># must include for generic inputs, will fix a = 0 and x = 1.0</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>


<span class="c1"># Fix time duration to a very large number (1000 years) so that we obtain the time duration from trajectory</span>

<span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="c1"># initial time setp,</span>
              <span class="n">T</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">,</span>
              <span class="n">err</span><span class="o">=</span><span class="mf">1e-10</span> <span class="c1"># integrator error</span>
             <span class="p">)</span>

<span class="n">mass_ratio_vector</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.0</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">tfinal</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">count</span><span class="p">,</span><span class="n">epsilon</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mass_ratio_vector</span><span class="p">):</span>

    <span class="c1"># get secondary mass for fixed mass ratio</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">M</span> <span class="o">*</span> <span class="n">epsilon</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">xI</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">,</span> <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
                                                  <span class="n">Phi_phi0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                                  <span class="n">Phi_theta0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                                  <span class="n">Phi_r0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                                  <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># inspiral duration (divide by YRSID_SI to get it in years)</span>
    <span class="n">tfinal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">count</span><span class="o">%</span><span class="k">3</span> == 0:
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;For a mass-ratio of epsilon = </span><span class="si">{}</span><span class="s2">, time duration is T = </span><span class="si">{}</span><span class="s2"> years&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">mass_ratio_vector</span><span class="p">,</span> <span class="n">tfinal</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="s2">&quot;16&quot;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Time duration [years]&#39;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Mass ratio&#39;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="discussion-of-plot-above">
<h3>Discussion of plot above<a class="headerlink" href="#discussion-of-plot-above" title="Permalink to this heading">#</a></h3>
<p>In each trajectory calculation, the initial semi-latus rectum is fixed. The only quantity that is changing is the mass ratio <span class="math notranslate nohighlight">\(\epsilon = \mu/M\)</span>. As <span class="math notranslate nohighlight">\(\epsilon\)</span> decreases, the trajectory evolution time increases. The time of evolut ion is thus inversely proportional to the mass-ratio of the system. We thus see that</p>
<div class="math notranslate nohighlight">
\[
T_{\text{observation}} \sim 1/\epsilon
\]</div>
<p>Notice that for <span class="math notranslate nohighlight">\(\epsilon = 10^{-7}\)</span>, with the parameters given above, it would have taken 396 years to plunge. Whereas with a mass-ratio of <span class="math notranslate nohighlight">\(\epsilon = 10^{-4}\)</span>, it would have only taken 144 days.</p>
<p>Cool.</p>
</section>
</section>
<section id="exercise-1">
<h2>Exercise 1<a class="headerlink" href="#exercise-1" title="Permalink to this heading">#</a></h2>
<p>Let us now understand how the inspiral duration changes for different initial eccentricity or different initial semi-latus rectum. Remember the range of validity of the parameters and produce two plots:</p>
<ol class="arabic simple">
<li><p>Time duration vs initial eccentricity (fixing all the other parameters)</p></li>
<li><p>Time duration vs initial semi-latus rectum (fixing all the other parameters)</p></li>
</ol>
<p>If you have time, produce also this plot:</p>
<ol class="arabic simple" start="3">
<li><p>Time duration vs M/epsilon (M=Mass MBHS and epsilon=Mass ratio). Prove that, for different total masses and mass ratios, the behavior of Time duration vs M/epsilon is always the same (Hint: use two for loops, one for <span class="math notranslate nohighlight">\(M\)</span> and the other for <span class="math notranslate nohighlight">\(\epsilon\)</span>).</p></li>
</ol>
<p>You should find that:</p>
<ol class="arabic simple">
<li><p>The relation between time-duration and eccentricity is weak</p></li>
<li><p>The relation between time-duration and semi-latus rectum is near-linear</p></li>
<li><p>The relation between time-duration and <span class="math notranslate nohighlight">\(M/\epsilon\)</span> is perfectly linear.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Time duration vs initial eccentricity -- It&#39;s your turn!</span>

<span class="c1">## # set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1"># range [separatrix, 45]</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c1"># range [0.0, 0.7]</span>

<span class="c1"># run trajectory</span>
<span class="c1"># must include for generic inputs, will fix a = 0 and x = 1.0</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>


<span class="c1"># Fix time duration to a very large number (100 years) so that we obtain the time duration from trajectory</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="c1"># initial time setp,</span>
              <span class="n">T</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">,</span>
              <span class="n">err</span><span class="o">=</span><span class="mf">1e-10</span> <span class="c1"># integrator error</span>
             <span class="p">)</span>

<span class="c1"># ecc = np.linspace(0.01, 0.7, num=10)</span>

<span class="c1"># tfinal = []</span>
<span class="c1"># for e0 in ecc:</span>

<span class="c1">#  [INPUT YOUR CODE IN HERE]</span>

<span class="c1">#     tfinal.append(t[-1]/YRSID_SI)</span>


<span class="c1"># plt.figure()</span>
<span class="c1"># plt.plot(ecc, tfinal)</span>
<span class="c1"># plt.ylabel(&#39;Time duration [years]&#39;)</span>
<span class="c1"># plt.xlabel(&#39;e0&#39;)</span>
<span class="c1"># plt.show()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Time duration vs initial semi-latus rectum</span>

<span class="c1">## # set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1"># range [separatrix, 45]</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c1"># range [0.0, 0.7]</span>

<span class="c1"># run trajectory</span>
<span class="c1"># must include for generic inputs, will fix a = 0 and x = 1.0</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>


<span class="c1"># Fix time duration to a very large number (100 years) so that we obtain the time duration from trajectory</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="c1"># initial time setp,</span>
              <span class="n">T</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">,</span>
              <span class="n">err</span><span class="o">=</span><span class="mf">1e-10</span> <span class="c1"># integrator error</span>
             <span class="p">)</span>

<span class="c1"># tfinal = []</span>
<span class="c1"># e0 = 0.0 # reset eccentricity</span>
<span class="c1"># pp = np.linspace(7.0, 30.0, num=10)</span>
<span class="c1"># for p0 in pp:</span>

<span class="c1">#  [INPUT YOUR CODE IN HERE]</span>

<span class="c1">#     tfinal.append(t[-1]/YRSID_SI)</span>


<span class="c1"># plt.figure()</span>
<span class="c1"># plt.loglog(pp, tfinal)</span>
<span class="c1"># plt.ylabel(&#39;Time duration [years]&#39;)</span>
<span class="c1"># plt.xlabel(&#39;p0&#39;)</span>
<span class="c1"># plt.show()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## # set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1"># range [separatrix, 45]</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c1"># range [0.0, 0.7]</span>

<span class="c1"># run trajectory</span>
<span class="c1"># must include for generic inputs, will fix a = 0 and x = 1.0</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>


<span class="c1"># Fix time duration to a very large number (100 years) so that we obtain the time duration from trajectory</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="c1"># initial time setp,</span>
              <span class="n">T</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">,</span>
              <span class="n">err</span><span class="o">=</span><span class="mf">1e-10</span> <span class="c1"># integrator error</span>
             <span class="p">)</span>

<span class="c1"># tfinal = []</span>
<span class="c1"># e0 = 0.2 # reset</span>
<span class="c1"># p0=10.0</span>

<span class="c1"># epsilon_vector = 10**np.linspace(-4.0, -6.0, num=10)</span>
<span class="c1"># Mvec = 10**np.linspace(4.0, 7.0, num=10)</span>

<span class="c1"># plt.figure()</span>
<span class="c1"># for M in [CODE HERE]:</span>
<span class="c1">#     tfinal = []</span>
<span class="c1">#     for epsilon in [CODE HERE]:</span>

<span class="c1">#         # get secondary mass for fixed mass ratio</span>

<span class="c1">#         mu = [CODE HERE]</span>
<span class="c1">#         CODE HERE -- Generate your trajectory for given choices of M and epsilon.</span>

<span class="c1">#         # inspiral duration (divide by YRSID_SI to get it in years)</span>
<span class="c1">#         tfinal.append(t[-1]/YRSID_SI)</span>

    <span class="c1"># plt.plot(M/epsilon_vector, tfinal)</span>
<span class="c1"># plt.ylabel(&#39;Time duration [years]&#39;)</span>
<span class="c1"># plt.xlabel(&#39;$M/\epsilon$&#39;)</span>
<span class="c1"># plt.show()</span>
</pre></div>
</div>
</div>
</div>
<section id="number-of-cycles-and-differences-between-trajectories">
<h3>Number of cycles and differences between trajectories<a class="headerlink" href="#number-of-cycles-and-differences-between-trajectories" title="Permalink to this heading">#</a></h3>
<p>It is often common to introduce the number of cycles <span class="math notranslate nohighlight">\(\mathcal{N}_\varphi (t)= \Phi_\varphi(t)/(2\pi)\)</span> to quantify the number of times the compact object orbits around the MBH. This is useful to quantify the difference between trajectories.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># run trajectory</span>
<span class="c1"># must include for generic inputs, will fix a = 0 and x = 1.0</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1"># range [separatrix, 45]</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c1"># range [0.0, 0.7]</span>

<span class="c1"># set initial parameters</span>
<span class="n">M1</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu1</span> <span class="o">=</span> <span class="mf">1e1</span>

<span class="n">t1</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">xI1</span><span class="p">,</span> <span class="n">Phi_phi1</span><span class="p">,</span> <span class="n">Phi_theta1</span><span class="p">,</span> <span class="n">Phi_r1</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M1</span><span class="p">,</span> <span class="n">mu1</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
                                              <span class="n">Phi_phi0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_theta0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_r0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="n">M2</span> <span class="o">=</span> <span class="mf">5e5</span>
<span class="n">mu2</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">t2</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">xI2</span><span class="p">,</span> <span class="n">Phi_phi2</span><span class="p">,</span> <span class="n">Phi_theta2</span><span class="p">,</span> <span class="n">Phi_r2</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M2</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
                                              <span class="n">Phi_phi0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_theta0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_r0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t1</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">,</span><span class="n">Phi_phi1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mu=</span><span class="si">{</span><span class="n">mu1</span><span class="si">}</span><span class="s1">, M=</span><span class="si">{</span><span class="n">M1</span><span class="o">/</span><span class="mf">1e6</span><span class="si">}</span><span class="s1"> x $10^6$, $\epsilon$ = </span><span class="si">{</span><span class="n">mu1</span><span class="o">/</span><span class="n">M1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t2</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">,</span><span class="n">Phi_phi2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mu=</span><span class="si">{</span><span class="n">mu2</span><span class="si">}</span><span class="s1">, M=</span><span class="si">{</span><span class="n">M2</span><span class="o">/</span><span class="mf">1e6</span><span class="si">}</span><span class="s1"> x $10^6$, $\epsilon$ = </span><span class="si">{</span><span class="n">mu2</span><span class="o">/</span><span class="n">M2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of cycles&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t [years]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Final number of cycles of system 1 with mu = </span><span class="si">{}</span><span class="s2"> and M = </span><span class="si">{}</span><span class="s2"> is N_cyles = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mu1</span><span class="p">,</span><span class="n">M1</span><span class="p">,</span><span class="n">Phi_phi1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Final number of cycles of system 2 with mu = </span><span class="si">{}</span><span class="s2"> and M = </span><span class="si">{}</span><span class="s2"> is N_cycles = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mu2</span><span class="p">,</span><span class="n">M2</span><span class="p">,</span><span class="n">Phi_phi2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>The two systems have the same mass ratio and the same final number of cycles. However, the number of cycles accumulated per second is different. An EMRI system with larger MBH “more slowly” than a system with smaller <code class="docutils literal notranslate"><span class="pre">M</span></code>.  Notice that the frequencies are related to the time derivative of the number of cycles</p>
<div class="math notranslate nohighlight">
\[
\frac{d}{dt} \mathcal{N}_\varphi = \frac{1}{2 \pi}\frac{d}{dt} \Phi_\varphi = \frac{1}{2 \pi} \Omega_\varphi\, .
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># run trajectory</span>
<span class="c1"># must include for generic inputs, will fix a = 0 and x = 1.0</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1"># range [separatrix, 45]</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c1"># range [0.0, 0.7]</span>

<span class="c1"># set initial parameters</span>
<span class="n">M1</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu1</span> <span class="o">=</span> <span class="mf">1e1</span>

<span class="n">epsilon</span> <span class="o">=</span> <span class="n">mu</span><span class="o">/</span><span class="n">M</span>



<span class="n">t1</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">xI1</span><span class="p">,</span> <span class="n">Phi_phi1</span><span class="p">,</span> <span class="n">Phi_theta1</span><span class="p">,</span> <span class="n">Phi_r1</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M1</span><span class="p">,</span> <span class="n">mu1</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
                                              <span class="n">Phi_phi0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_theta0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_r0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="n">OmegaPhi1</span><span class="p">,</span> <span class="n">OmegaTheta1</span><span class="p">,</span> <span class="n">OmegaR1</span> <span class="o">=</span> <span class="n">get_fundamental_frequencies</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">xI1</span><span class="p">)</span>

<span class="n">M2</span> <span class="o">=</span> <span class="mf">5e5</span>
<span class="n">mu2</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">t2</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">xI2</span><span class="p">,</span> <span class="n">Phi_phi2</span><span class="p">,</span> <span class="n">Phi_theta2</span><span class="p">,</span> <span class="n">Phi_r2</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M2</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">xI1</span><span class="p">,</span>
                                              <span class="n">Phi_phi0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_theta0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_r0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="n">OmegaPhi2</span><span class="p">,</span> <span class="n">OmegaTheta2</span><span class="p">,</span> <span class="n">OmegaR2</span> <span class="o">=</span> <span class="n">get_fundamental_frequencies</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">xI2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t1</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">,</span><span class="n">OmegaPhi1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mu=</span><span class="si">{</span><span class="n">mu1</span><span class="si">}</span><span class="s1">, M=</span><span class="si">{</span><span class="n">M1</span><span class="o">/</span><span class="mf">1e6</span><span class="si">}</span><span class="s1"> x $10^6$, $\epsilon$ = </span><span class="si">{</span><span class="n">mu1</span><span class="o">/</span><span class="n">M1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t2</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">,</span><span class="n">OmegaPhi2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mu=</span><span class="si">{</span><span class="n">mu2</span><span class="si">}</span><span class="s1">, M=</span><span class="si">{</span><span class="n">M2</span><span class="o">/</span><span class="mf">1e6</span><span class="si">}</span><span class="s1"> x $10^6$, $\epsilon$ = </span><span class="si">{</span><span class="n">mu2</span><span class="o">/</span><span class="n">M2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$dN_{\phi}/dt$&#39;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t [seconds]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="exercise-2">
<h2>Exercise 2<a class="headerlink" href="#exercise-2" title="Permalink to this heading">#</a></h2>
<p>Plot the FINAL number of cycles (<code class="docutils literal notranslate"><span class="pre">Ncycle.append(Phi_phi[-1]/(2*np.pi))</span></code>) for different mass ratios. What do you find? If you see a linear relationship then well done!!!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>

<span class="c1"># run trajectory</span>
<span class="c1"># must include for generic inputs, will fix a = 0 and x = 1.0</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1"># range [separatrix, 45]</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c1"># range [0.0, 0.7]</span>

<span class="c1"># Ncycle = []</span>
<span class="c1"># for epsilon in epsilon_vector:</span>

<span class="c1">#     # get secondary mass for fixed mass ratio</span>
<span class="c1">#     mu = [CODE HERE]</span>
<span class="c1">#     t, p, e, xI, Phi_phi, Phi_theta, Phi_r = [CODE HERE]</span>

<span class="c1">#     Ncycle.append([CODE HERE])</span>


<span class="c1"># plt.figure()</span>
<span class="c1"># plt.loglog(mass_ratio_vector, Ncycle)</span>
<span class="c1"># plt.ylabel(&#39;Number of cycles&#39;)</span>
<span class="c1"># plt.xlabel(&#39;Mass ratio&#39;)</span>
<span class="c1"># plt.show()</span>
</pre></div>
</div>
</div>
</div>
<section id="fundamental-frequencies-and-harmonics">
<h3>Fundamental frequencies and harmonics<a class="headerlink" href="#fundamental-frequencies-and-harmonics" title="Permalink to this heading">#</a></h3>
<p>Over short time-scales, an EMRI Waveform can thought as a Fourier series where the frequencies <span class="math notranslate nohighlight">\(\omega_{mnk}\)</span> are given by</p>
<div class="math notranslate nohighlight">
\[
\omega_{mnk} = m \Omega_\varphi + n \Omega_r + k \Omega_\theta
\]</div>
<p>Therefore is possible to plot the frequency evolution of each harmonic given a trajectory. This can be useful to understand which frequency range each harmonic spans.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># run trajectory</span>
<span class="c1"># must include for generic inputs, will fix a = 0 and x = 1.0</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1"># range [separatrix, 45]</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c1"># range [0.0, 0.7]</span>

<span class="c1"># set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>

<span class="n">t1</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">xI1</span><span class="p">,</span> <span class="n">Phi_phi1</span><span class="p">,</span> <span class="n">Phi_theta1</span><span class="p">,</span> <span class="n">Phi_r1</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
                                              <span class="n">Phi_phi0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_theta0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_r0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="c1"># get the fundamental frequencies</span>
<span class="n">OmegaPhi1</span><span class="p">,</span> <span class="n">OmegaTheta1</span><span class="p">,</span> <span class="n">OmegaR1</span> <span class="o">=</span> <span class="n">get_fundamental_frequencies</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">xI1</span><span class="p">)</span>

<span class="n">M2</span> <span class="o">=</span> <span class="mf">5e5</span>
<span class="n">mu2</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">t2</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">xI2</span><span class="p">,</span> <span class="n">Phi_phi2</span><span class="p">,</span> <span class="n">Phi_theta2</span><span class="p">,</span> <span class="n">Phi_r2</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M2</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
                                              <span class="n">Phi_phi0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_theta0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_r0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="n">OmegaPhi2</span><span class="p">,</span> <span class="n">OmegaTheta2</span><span class="p">,</span> <span class="n">OmegaR2</span> <span class="o">=</span> <span class="n">get_fundamental_frequencies</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">xI2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="c1"># we need to divide by the total Mass and convert to seconds</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">OmegaPhi</span> <span class="o">/</span> <span class="p">(</span><span class="n">M1</span> <span class="o">*</span> <span class="n">MTSUN_SI</span><span class="p">)</span> <span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mu=</span><span class="si">{</span><span class="n">mu1</span><span class="si">}</span><span class="s1">, M=</span><span class="si">{</span><span class="n">M1</span><span class="o">/</span><span class="mf">1e6</span><span class="si">}</span><span class="s1"> x $10^6$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span><span class="n">OmegaPhi2</span><span class="o">/</span> <span class="p">(</span><span class="n">M2</span> <span class="o">*</span> <span class="n">MTSUN_SI</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mu=</span><span class="si">{</span><span class="n">mu2</span><span class="si">}</span><span class="s1">, M=</span><span class="si">{</span><span class="n">M2</span><span class="o">/</span><span class="mf">1e6</span><span class="si">}</span><span class="s1"> x $10^6$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Omega_\varphi$ [1/s]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t [s]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The system with smaller MBH mass spans more frequencies and evolves more quickly than the system with larger MBH mass. This piece of code will be exceptionally useful for a later exercise. Understand here that, for the <span class="math notranslate nohighlight">\(\phi\)</span> angular frequency <span class="math notranslate nohighlight">\(\Omega_{\phi}\)</span>, we can determine up to what mode in <span class="math notranslate nohighlight">\(m\)</span> we are sensitive to when analysing EMRI waveforms.</p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="schwarzchild-waveforms-in-the-source-frame">
<h1>Schwarzchild Waveforms in the source frame<a class="headerlink" href="#schwarzchild-waveforms-in-the-source-frame" title="Permalink to this heading">#</a></h1>
<p>So far in this tutorial we have focused on how to generate the trajectory of the smaller body around a massive black hole given an initial set of input parameters. Now, given a set of input parameters that determine a trajectory, we will focus on how to generate the final source frame Schwarzschild waveform. The rest of this tutorial will focus on time domain, frequency domain and time-frequency domain representations of EMRI waveforms. There will also be a few extra, more data analysis focused exercises as one progresses through the tutorial.</p>
<p>We begin with the time-domain representation of an EMRI waveform.</p>
<section id="time-domain-representation-of-waveforms">
<h2>Time Domain Representation of Waveforms<a class="headerlink" href="#time-domain-representation-of-waveforms" title="Permalink to this heading">#</a></h2>
<p>At large luminosity distances from the source, the source-frame EMRI waveform is given by</p>
<div class="math notranslate nohighlight">
\[
    h_{+} - ih_{\times} = \frac{\mu}{d_L}\sum_{lmn} A_{lmn}(p(t),e(t),x_{I}(t)) \, S_{lmn}(\theta,\phi) \, \exp(-i\Phi_{mn}(t)).
\]</div>
<p><em>Note:</em> We will not give a detailed tutorial on the pieces that determine the harmonic content of the amplitudes <span class="math notranslate nohighlight">\(A_{lmn}\)</span> or the spin weighted spherical harmonics <span class="math notranslate nohighlight">\(S_{lmn}\)</span>. That’s outside the scope of this work though, if people are curious, feel free to talk to me.</p>
</section>
<section id="gpu-acceleration">
<h2>GPU acceleration<a class="headerlink" href="#gpu-acceleration" title="Permalink to this heading">#</a></h2>
<p>From a data analysis perspective, we require EMRI waveforms that can be generated in around one second. This is due to the immense number of waveform generations required for parameter estimation algorithms, which is likely only a fraction of the amount required for the actual search phase! The speed of EMRI waveforms depend on two crucial ingredients. One is how quickly the trajectory can be built and the other is how quickly the individual harmonics (pairs of modes eg. (l,m,n) = (2,2,0) ) can all be summed. For orbits with significant eccentricities, the numbers of harmonics can be huge (in the thousands)!</p>
<p>The trajectories are quickly computed by integrating on a sparse grid that becomes more fine as the separatrix is approached. The waveforms are quickly generated by exploting GPUs to parallelise the sum over <span class="math notranslate nohighlight">\((l,m,n)\)</span>. Compared to single CPUs, speed ups of order <span class="math notranslate nohighlight">\(\sim 2500\)</span> are observed when compared to a single GPU. In this tutorial, using google collab, we will use google collabs basic GPU version.</p>
<p><img alt="image.png" src="https://github.com/OllieBurke/EMRI_Workshop/blob/main/docs/images/gpu.jpg?raw=true" /></p>
<p>The next few cells will focus on generating the EMRI waveform in the time domain.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We first define a few key word arguments to help our EMRI generator understand precisely what we want.</span>

<span class="c1"># GPU accelerated waveforms, this is an absolute game changer.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cupy</span> <span class="k">as</span> <span class="nn">cp</span>
    <span class="n">use_gpu</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">xp</span> <span class="o">=</span> <span class="n">cp</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">use_gpu</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">xp</span> <span class="o">=</span> <span class="n">np</span>



<span class="n">few_gen</span> <span class="o">=</span> <span class="n">FastSchwarzschildEccentricFlux</span><span class="p">(</span>
    <span class="n">inspiral_kwargs</span><span class="o">=</span><span class="n">inspiral_kwargs</span><span class="p">,</span>
    <span class="n">amplitude_kwargs</span><span class="o">=</span><span class="n">amplitude_kwargs</span><span class="p">,</span>
    <span class="n">Ylm_kwargs</span><span class="o">=</span><span class="n">Ylm_kwargs</span><span class="p">,</span>
    <span class="n">sum_kwargs</span><span class="o">=</span><span class="n">sum_kwargs</span><span class="p">,</span>
    <span class="n">use_gpu</span><span class="o">=</span><span class="n">use_gpu</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e2</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">12.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>  <span class="c1"># polar viewing angle in source frame</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>  <span class="c1"># azimuthal viewing angle in source frame</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">10.0</span>

<span class="n">wave</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span><span class="n">Phi_phi0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>  <span class="c1">#  assumes dt = 10.0 for max T = 0.01 year</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="k">if</span> <span class="n">use_gpu</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">[:</span><span class="mi">400</span><span class="p">]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">imag</span><span class="p">[:</span><span class="mi">400</span><span class="p">]))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">[:</span><span class="mi">400</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">imag</span><span class="p">[:</span><span class="mi">400</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="emri-waveforms-in-different-domains">
<h2>EMRI Waveforms in different domains<a class="headerlink" href="#emri-waveforms-in-different-domains" title="Permalink to this heading">#</a></h2>
<p>The output of FEW is a time domain waveform, i.e. the dimensionless strain as a function of time. Later on in this tutorial we will discuss a frequency domain model. We are currently working on trying to output an EMRI waveform directly in the time-frequency domain… watch this space!</p>
<p>Let’s have a look at the waveform at different stages of the trajectory.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.63</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>  <span class="c1"># polar viewing angle in source frame</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>  <span class="c1"># azimuthal viewing angle in source frame</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="c1"># notice that we are providing the distance parameter</span>
<span class="n">wave</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>  <span class="c1">#  assumes dt = 10.0 for max T = 1.0 year</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">wave</span><span class="p">))</span><span class="o">*</span><span class="n">dt</span>

<span class="c1"># On my local machine, this took me five minutes to execute. I hope you have a GPU enabled!</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-full-signal">
<h2>The full signal<a class="headerlink" href="#the-full-signal" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="k">if</span> <span class="n">use_gpu</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">,</span> <span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">,</span> <span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$h_+$&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t [years]&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>What we can now do is check to see how the waveform evolves in time. Given our recently built intuition from the trajectory part of the tutorial, we should expect to see the rate of change of frequency evolve with time. We will now compare snapshots of the waveform as the smaller body gets closer to the separatrix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">xI</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">,</span> <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
                                              <span class="n">Phi_phi0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_theta0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_r0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="n">j0</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">j1</span> <span class="o">=</span> <span class="mi">3000000</span>
<span class="n">j2</span> <span class="o">=</span> <span class="mi">6000000</span>
<span class="n">j3</span> <span class="o">=</span> <span class="o">-</span><span class="mi">400</span>

<span class="n">t_index_j1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">t</span> <span class="o">&gt;</span> <span class="n">time</span><span class="p">[</span><span class="n">j1</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">t_index_j2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">t</span> <span class="o">&gt;</span> <span class="n">time</span><span class="p">[</span><span class="n">j2</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">t_index_j3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">t</span> <span class="o">&gt;</span> <span class="n">time</span><span class="p">[</span><span class="n">j3</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">t_index_j3</span><span class="p">)</span>

<span class="k">if</span> <span class="n">use_gpu</span><span class="p">:</span>
    <span class="n">wave_np</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">wave_np</span> <span class="o">=</span> <span class="n">wave</span><span class="o">.</span><span class="n">real</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Location of small body&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">,</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Small body&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">400</span><span class="p">]</span><span class="o">/</span><span class="mi">60</span><span class="p">,</span> <span class="n">wave_np</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">400</span><span class="p">])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Waveform&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">t_index_j1</span><span class="p">]</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">,</span><span class="n">p</span><span class="p">[</span><span class="n">t_index_j1</span><span class="p">],</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j1</span> <span class="o">+</span> <span class="mi">400</span><span class="p">]</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">,</span> <span class="n">wave_np</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j1</span> <span class="o">+</span> <span class="mi">400</span><span class="p">])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">t_index_j2</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="n">t_index_j2</span><span class="p">],</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="n">j2</span><span class="p">:</span><span class="n">j2</span> <span class="o">+</span> <span class="mi">400</span><span class="p">]</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">,</span> <span class="n">wave_np</span><span class="p">[</span><span class="n">j2</span><span class="p">:</span><span class="n">j2</span> <span class="o">+</span> <span class="mi">400</span><span class="p">])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">t_index_j3</span><span class="p">]</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">,</span><span class="n">p</span><span class="p">[</span><span class="n">t_index_j3</span><span class="p">],</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="n">j3</span><span class="p">:]</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">,</span> <span class="n">wave_np</span><span class="p">[</span><span class="n">j3</span><span class="p">:])</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;t [years]&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$p(t)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$h_+$&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;t [years]&#39;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;t [minutes]&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
        <span class="c1"># ax[0][j].set_xlabel(&#39;t [years]&#39;, fontsize = 16)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Notice that as the smaller body ventures closer to the separatrix, both the amplitude and frequencies become larger and larger.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="optional-exercise">
<h1>Optional Exercise<a class="headerlink" href="#optional-exercise" title="Permalink to this heading">#</a></h1>
<p>Repeat the same plot as above but instead of plotting the evolution of semi-latus rectum, plot the angular frequency <span class="math notranslate nohighlight">\(\Omega_{\phi}\)</span>.</p>
<section id="fourier-domain-signal-to-noise-ratio-and-overlaps">
<h2>Fourier Domain, Signal to noise ratio and Overlaps.<a class="headerlink" href="#fourier-domain-signal-to-noise-ratio-and-overlaps" title="Permalink to this heading">#</a></h2>
<p>Within gravitational wave astronomy, data analysis is usually conducted in the frequency domain. This is for a multitude of reasons, one being that our probabilistic models used for inferring parameters (such as the likelihood) dramatically simplifies in comparison to its time-domain counterpart. Similarly, analysing gravitational waveforms as a function of frequency may simply reveal more information about the underlying structure of the signal. In this section, we will define the power spectral density of the noise <span class="math notranslate nohighlight">\(S_{n}(f)\)</span>, a function that qualitatively describes the root mean square average of noise fluctuations from some stationary process. We will then analyse the EMRI waveform in the frequency domain and compute a few useful statistics used within gravitaitonal wave astronomy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load Power Spectral Density of LISA. This represents how loud the instrumental noise is.</span>
<span class="k">def</span> <span class="nf">PowerSpectralDensity</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PSD obtained from: https://arxiv.org/pdf/1803.01944.pdf</span>

<span class="sd">    Removed galactic confusion noise.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">L</span> <span class="o">=</span> <span class="mf">2.5</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">9</span>   <span class="c1"># Length of LISA arm</span>
    <span class="n">f0</span> <span class="o">=</span> <span class="mf">19.09</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>

    <span class="n">Poms</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.5</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">11</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="n">f</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># Optical Metrology Sensor</span>
    <span class="n">Pacc</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">15</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">3</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">f</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">f</span><span class="o">/</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">3</span><span class="p">))</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># Acceleration Noise</span>

    <span class="n">PSD</span> <span class="o">=</span> <span class="p">((</span><span class="mi">10</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">Poms</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">Pacc</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">f</span><span class="p">))</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.6</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="o">/</span><span class="n">f0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># PSD</span>

    <span class="k">return</span> <span class="n">PSD</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we take the Fast Fourier transform of the signal</span>
<span class="n">hp_fft</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span>
<span class="n">hx_fft</span> <span class="o">=</span> <span class="o">-</span><span class="n">xp</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span>

<span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfftfreq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wave</span><span class="p">),</span><span class="n">dt</span><span class="p">)</span>
<span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">PSD_np</span> <span class="o">=</span> <span class="n">PowerSpectralDensity</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
<span class="k">if</span> <span class="n">use_gpu</span><span class="p">:</span>
    <span class="n">PSD_cp</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">PSD_np</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="k">if</span> <span class="n">use_gpu</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">hp_fft</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Frequency domain EMRI&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">hp_fft</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Frequency domain EMRI&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">PSD_np</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Approx LISA Sensitivity curve&#39;</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mf">1e-5</span><span class="p">,</span><span class="mf">1e-1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">1e-44</span><span class="p">,</span><span class="mf">1e-29</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$|\tilde</span><span class="si">{h}</span><span class="s1">(f)|^2$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;f [Hz]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We define the inner product:
$<span class="math notranslate nohighlight">\(
(a (t)|b (t)) =4 \Re \int _{0} ^\infty \frac{\tilde{a} ^* (f) \tilde{b} (f) }{S_n (f)} \, {\rm d} f \, .
\)</span><span class="math notranslate nohighlight">\(
where the tilde indicates the Fourier transform, the symbol \)</span>^*<span class="math notranslate nohighlight">\( indicates the complex conjugation, and \)</span>S_n (f)<span class="math notranslate nohighlight">\( is the one-sided noise power spectral density, which can be interpreted as the size of the root mean square fluctuations at a given frequency \)</span>\Delta n _{\text{rms}} \sim \sqrt{S_n(f) \Delta f}<span class="math notranslate nohighlight">\(. From a practical point of view the spectral density represents our information on the detector sensitivity and the aforementioned inner product can be used to quantify the Signal to Noise Ratio (SNR) of a waveform \)</span>h(t)$:</p>
<div class="math notranslate nohighlight">
\[
{\rm SNR}^2 =(h (t)|h (t)) =4 \Re \int _{0} ^\infty \frac{|\tilde{h} (f)| }{S_n (f)} \, {\rm d} f \approx 4 \Re \sum_{i=0}^{N/2 - 1}\frac{|\tilde{h}(f_{i})|^2}{S_{n}(f_{i})}\Delta f\, .
\]</div>
<p>for <span class="math notranslate nohighlight">\(\Delta f\)</span> the spacing between frequencies defined by <span class="math notranslate nohighlight">\(\Delta f = 1/N\Delta t = 1/T_{\text{observation}}\)</span>.
EMRIs are usually considered to be detectable for <span class="math notranslate nohighlight">\(SNR\gtrsim 15\)</span> or so</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">inner_product</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">dt</span><span class="p">):</span>
    <span class="n">a_tilde</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span>
    <span class="n">b_tilde</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfftfreq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="n">dt</span><span class="p">)</span>
    <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">freq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">psd_f</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">PowerSpectralDensity</span><span class="p">(</span><span class="n">freq</span><span class="p">))</span>
    <span class="n">inn_prod_cp</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">xp</span><span class="o">.</span><span class="n">real</span> <span class="p">(</span> <span class="n">xp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">xp</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">a_tilde</span><span class="p">)</span> <span class="o">*</span> <span class="n">b_tilde</span> <span class="o">*</span> <span class="n">df</span> <span class="o">/</span> <span class="n">psd_f</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">inn_prod_np</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">inn_prod_cp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">inn_prod_np</span>

<span class="c1"># the SNR of the previous waveform is</span>
<span class="n">SNR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">inner_product</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">dt</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SNR =&quot;</span><span class="p">,</span><span class="n">SNR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="exercise-3">
<h3>Exercise 3<a class="headerlink" href="#exercise-3" title="Permalink to this heading">#</a></h3>
<p>Verify that the SNR of an EMRI waveform is:</p>
<ul class="simple">
<li><p>inversely proportional to the distance</p></li>
<li><p>directly proportional to the secondary mass <code class="docutils literal notranslate"><span class="pre">mu</span></code> for fixed total Mass and duration. Make sure that the source does not plunge before the times provided. Otherwise, you might not get the direct proportionality, i.e. set T=<code class="docutils literal notranslate"><span class="pre">0.001</span></code> and vary <span class="math notranslate nohighlight">\(\mu\in[10,100]\)</span>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># your turn</span>

<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.63</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>  <span class="c1"># polar viewing angle in source frame</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>  <span class="c1"># azimuthal viewing angle in source frame</span>


<span class="n">dt</span> <span class="o">=</span> <span class="mf">10.0</span>

<span class="c1"># plt.figure()</span>
<span class="c1"># for dd in np.linspace(1.0,5.0,num=10):</span>
<span class="c1">#     wave = few_gen(M, mu, p0, e0, theta, phi, dist=dd, dt=dt, T=2.0)</span>
<span class="c1">#     SNR = [INSERT YOUR CODE HERE ]</span>
<span class="c1">#     plt.plot([INSERT YOUR CODE HERE])</span>

<span class="c1"># plt.xlabel(&#39;1/d&#39;)</span>
<span class="c1"># plt.ylabel(&#39;SNR&#39;)</span>
<span class="c1"># plt.show()</span>


<span class="c1"># plt.figure()</span>
<span class="c1"># for mu in np.linspace(1.0,100.0,num=10):</span>
<span class="c1">#     wave = few_gen(M, mu, p0, e0, theta, phi, dist=1.0, dt=dt, T=0.1)</span>
<span class="c1">#     SNR = [INSERT YOUR CODE HERE]</span>
<span class="c1">#     plt.plot([INSERT YOUR CODE HERE])</span>
<span class="c1"># plt.xlabel(&#39;mu&#39;)</span>
<span class="c1"># plt.ylabel(&#39;SNR&#39;)</span>
<span class="c1"># plt.show()</span>
</pre></div>
</div>
</div>
</div>
<p>We will now introduce another quantity which will be useful for estimating qualitatively how different two waveforms <span class="math notranslate nohighlight">\(a(t)\)</span> and <span class="math notranslate nohighlight">\(b(t)\)</span> are. We define the ehe Overlap <span class="math notranslate nohighlight">\(\mathcal{O}(a,b)\)</span> between two waveform models <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span> by:
$<span class="math notranslate nohighlight">\(
\mathcal{O} (a,b) = \frac{&lt;{a}|{b}&gt;}{\sqrt{&lt;{a}|{a}&gt;} \sqrt{&lt;{b}|{b}&gt;}} \in [-1,1] \, .
\)</span><span class="math notranslate nohighlight">\(
The overlap expresses how similar two signals \)</span>a<span class="math notranslate nohighlight">\( and \)</span>b<span class="math notranslate nohighlight">\( by weighting the product with the power spectral density of the detector \)</span>S_n (f)$. If two signals are identical then the overlap is 1. Another quantity often used in gravitational wave data analysis is the mismatch which is defined as 1 minus the overlap.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">overlap</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">dt</span><span class="p">):</span>
    <span class="n">a_b</span> <span class="o">=</span> <span class="n">inner_product</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>
    <span class="n">a_a</span> <span class="o">=</span> <span class="n">inner_product</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>
    <span class="n">b_b</span> <span class="o">=</span> <span class="n">inner_product</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a_b</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_a</span> <span class="o">*</span> <span class="n">b_b</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;overlap of a signal with itself = &quot;</span><span class="p">,</span><span class="n">overlap</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">dt</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.63</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>  <span class="c1"># polar viewing angle in source frame</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>  <span class="c1"># azimuthal viewing angle in source frame</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">10.0</span>

<span class="n">base_sig</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">t_base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">base_sig</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;inferno&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_base</span><span class="p">[:</span><span class="mi">100</span><span class="p">],</span><span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">base_sig</span><span class="o">.</span><span class="n">real</span><span class="p">[:</span><span class="mi">100</span><span class="p">]))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;phase&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Overlap&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$h_+$&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">xp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">phase</span><span class="p">)</span>
    <span class="n">t_wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>
    <span class="n">O</span> <span class="o">=</span> <span class="n">overlap</span><span class="p">(</span><span class="n">base_sig</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_wave</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">],</span><span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">]),</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">phase</span><span class="o">/</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span><span class="p">)))</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;time [seconds]&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">phase</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span><span class="p">)))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.63</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>  <span class="c1"># polar viewing angle in source frame</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>  <span class="c1"># azimuthal viewing angle in source frame</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">10.0</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;inferno&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$log_</span><span class="si">{10}</span><span class="s1">\delta e$&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Overlap&#39;</span><span class="p">)</span>
<span class="n">vec</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Here we will add small perturbations to parameters</span>
<span class="n">logd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span>

<span class="k">for</span> <span class="n">T</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
    <span class="n">base_sig</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
    <span class="n">O</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">delta</span> <span class="ow">in</span> <span class="n">vec</span><span class="p">:</span>
        <span class="n">wave</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">delta</span><span class="p">),</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
        <span class="n">O</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">overlap</span><span class="p">(</span><span class="n">base_sig</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">dt</span><span class="p">))</span>

    <span class="n">axs</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">logd</span><span class="p">,</span> <span class="p">(</span><span class="n">O</span><span class="p">)</span> <span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;T=</span><span class="si">{</span><span class="n">T</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-4">
<h3>Exercise 4<a class="headerlink" href="#exercise-4" title="Permalink to this heading">#</a></h3>
<p>Repeat the previous plot by varying each of the EMRI parameters. Which parameter makes the overlap drop faster?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # your turn</span>

<span class="c1"># parameters</span>
<span class="c1"># M = 1e6</span>
<span class="c1"># mu = 1e1</span>
<span class="c1"># p0 = 10.63</span>
<span class="c1"># e0 = 0.3</span>
<span class="c1"># theta = np.pi/3  # polar viewing angle in source frame</span>
<span class="c1"># phi = np.pi/4  # azimuthal viewing angle in source frame</span>
<span class="c1"># dt = 10.0</span>

<span class="c1"># cmap = matplotlib.cm.get_cmap(&#39;inferno&#39;)</span>
<span class="c1"># fig, axs = plt.subplots(1, 1)</span>
<span class="c1"># axs.set_xlabel(&#39;$\log_{10}\delta e$&#39;)</span>
<span class="c1"># axs.set_ylabel(&#39;Overlap&#39;)</span>
<span class="c1"># vec = 10**np.linspace(-6, -2,num=10)</span>
<span class="c1"># logd = np.log10(vec)</span>

<span class="c1"># T=2</span>

<span class="c1"># base_sig = few_gen(M, mu, p0, e0, theta, phi, dist=1.0, dt=dt, T=T)</span>

<span class="c1"># Focus on Parameter M</span>

<span class="c1"># O=[]</span>
<span class="c1"># for delta in vec:</span>
<span class="c1">#     wave = few_gen([INSERT CODE HERE], mu, p0, e0, theta, phi, dist=1.0, dt=dt, T=T)</span>
<span class="c1">#     O.append(overlap(base_sig.real,wave.real,dt))</span>

<span class="c1"># axs.scatter(logd, O , label=f&#39;M&#39;)</span>

<span class="c1"># Focus on Parameter mu</span>

<span class="c1"># O=[]</span>
<span class="c1"># for delta in vec:</span>
<span class="c1">#     wave = few_gen(M, [INSERT CODE HERE], p0, e0, theta, phi, dist=1.0, dt=dt, T=T)</span>
<span class="c1">#     O.append(overlap(base_sig.real,wave.real,dt))</span>

<span class="c1"># axs.scatter(logd, O , label=f&#39;mu&#39;)</span>

<span class="c1"># Focus on Parameter M</span>

<span class="c1"># O=[]</span>
<span class="c1"># for delta in vec:</span>
<span class="c1">#     wave = few_gen(M, mu, [INSERT CODE HERE], e0, theta, phi, dist=1.0, dt=dt, T=T)</span>
<span class="c1">#     O.append(overlap(base_sig.real,wave.real,dt))</span>

<span class="c1"># axs.scatter(logd, O , label=f&#39;p0&#39;)</span>


<span class="c1"># plt.legend()</span>
<span class="c1"># plt.show()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="reflection">
<h2>Reflection<a class="headerlink" href="#reflection" title="Permalink to this heading">#</a></h2>
<p>Let’s take a little bit of time to understand exactly what has happened in the plot above. What we are doing here is comparing the “similarity” between one base waveform and another waveform with identical parameter sets apart from the eccentricity. What we see here is that if we are to perturb the eccentricity, say, by a very small amount <span class="math notranslate nohighlight">\(\gtrsim 10^{-6}\)</span>, only then do we start to see a significant change in the waveform. Loosely speaking, this implies that the EMRI waveforms are immensely sensitive to small perturbations in their parameters.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="precision-of-emri-parameters">
<h1>Precision of EMRI Parameters<a class="headerlink" href="#precision-of-emri-parameters" title="Permalink to this heading">#</a></h1>
<section id="the-likelihood-function">
<h2>The Likelihood Function<a class="headerlink" href="#the-likelihood-function" title="Permalink to this heading">#</a></h2>
<p>As we saw in the previous exercise, the waveforms emitted from EMRI signals are immensely sensitive to perturbations in their parameters. If we were to detect and recover the parameters of an EMRI, we would find that our ability to measure their parameters would be unparalleled by any other gravitational wave source. We now wish to make this statement a little bit more concrete.</p>
<p>For a known form of the PSD, we define the likelihood function</p>
<div class="math notranslate nohighlight">
\[
\log p(d|\boldsymbol{\theta}) \approx - \frac{1}{2}(h_{e} - h(\boldsymbol{\theta}) | h_{e} - h(\boldsymbol{\theta}))
\]</div>
<p>for <span class="math notranslate nohighlight">\(h_{e}\)</span> the exact waveform model and <span class="math notranslate nohighlight">\(h(\boldsymbol{\theta})\)</span> some model template we wish to use to infer the parameters of the true waveform model. The dimension of the full EMRI parameter space is <span class="math notranslate nohighlight">\(\sim 14\)</span> dimensions and stochastic algorithms are normally used to estimate these parameters. We do not have time for this here, so instead we will show how sensitive the likelihood function is to a single parameter, let’s say the eccentricity <span class="math notranslate nohighlight">\(e\)</span>.</p>
<p>In the cell below, we will plot the log-likelihood.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.63</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>  <span class="c1"># polar viewing angle in source frame</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>  <span class="c1"># azimuthal viewing angle in source frame</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">10.0</span>

<span class="n">true_wave</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>  <span class="c1"># Generate true waveform</span>

<span class="c1"># plot likelihood</span>
<span class="n">spacing</span> <span class="o">=</span> <span class="mf">4.6e-8</span>

<span class="n">e_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">e0</span> <span class="o">-</span> <span class="mf">3.5</span><span class="o">*</span><span class="n">spacing</span><span class="p">,</span> <span class="n">e0</span> <span class="o">+</span> <span class="mf">3.5</span><span class="o">*</span><span class="n">spacing</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>  <span class="c1"># Construct range of eccentricity</span>
<span class="n">e_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">e0</span>  <span class="c1"># Make sure that e0 is contained. Log-likelihood should be zero at this point.</span>
<span class="n">e_range</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

<span class="n">llike_vec</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">ecc_val</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">e_range</span><span class="p">):</span>
  <span class="n">wave_iteration</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">ecc_val</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>  <span class="c1">#</span>
  <span class="n">diff</span> <span class="o">=</span> <span class="n">true_wave</span> <span class="o">-</span> <span class="n">wave_iteration</span> <span class="c1"># See likelihood equation above.</span>

  <span class="n">llike</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">inner_product</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span><span class="n">diff</span><span class="p">,</span><span class="n">dt</span><span class="p">))</span>  <span class="c1"># Compute likelihood value</span>
  <span class="n">llike_vec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">llike</span><span class="p">)</span>

<span class="c1"># Plot results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">e_range</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">llike_vec</span><span class="p">)),</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">e_range</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">llike_vec</span><span class="p">)),</span><span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Eccentricity&#39;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Likelihood&#39;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Plot of likelihood over 1 parameter&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>Reflection<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h1>
<p>If you look at the x axes, you will see that the likelihood is Gaussian in nature and is peaked at the true value <span class="math notranslate nohighlight">\(e_{0} = 0.3\)</span>. Due to how incredibly sensitive the EMRI waveform is to the initial eccentricity, we see that the likelihood quickly tapers off  and then very quickly tapers towards zero.</p>
<section id="cheap-way-to-estimate-precision-in-parameters-fisher-matrix">
<h2>Cheap way to estimate precision in parameters: Fisher Matrix<a class="headerlink" href="#cheap-way-to-estimate-precision-in-parameters-fisher-matrix" title="Permalink to this heading">#</a></h2>
<p>Instead of plotting the likelihood, there is a very cheap way to estimate our ability to measure parameters of EMRIs. One can compute the Fisher information matrix</p>
<div class="math notranslate nohighlight">
\[
\Gamma_{ij} = (\partial_{i}h | \partial_{j}h) = 4\mathbb{R}\int_{0}^{\infty}\frac{1}{S_{n}(f)}\bigg\rvert \frac{\partial \tilde{h}}{\partial \theta^{i}} \frac{\partial \tilde{h}^{\star}}{\partial \theta^{j}}\bigg\rvert^{2} df
\]</div>
<p>The diagonal elements of the inverse Fisher matrix gives a guide on how well one can measure the parameters of the system. We give an example of how a Fisher matrix and estimate for the <span class="math notranslate nohighlight">\(1\sigma\)</span> precision of the eccentricity below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">de</span> <span class="o">=</span> <span class="mf">1e-7</span>  <span class="c1"># Set step size for numerical derivative</span>

<span class="n">wave_p</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span> <span class="o">+</span> <span class="n">de</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">wave_m</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span> <span class="o">-</span> <span class="n">de</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">deriv_wave</span> <span class="o">=</span> <span class="p">((</span><span class="n">wave_p</span> <span class="o">-</span> <span class="n">wave_m</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">de</span><span class="p">))</span> <span class="c1"># Compute Derivative</span>

<span class="n">deriv_wave_fft</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">deriv_wave</span><span class="p">)</span>

<span class="n">gamma_ee</span> <span class="o">=</span> <span class="n">inner_product</span><span class="p">(</span><span class="n">deriv_wave</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">deriv_wave</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>  <span class="c1"># Just a scalar</span>

<span class="n">precision_e</span> <span class="o">=</span> <span class="n">gamma_ee</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># Reciprocal and square root.</span>

<span class="c1"># precision_e above is our approximate for the 1\sigma width of the likelihood</span>
<span class="c1"># function.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s check our result!</span>
<span class="n">precision_e_np</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">precision_e</span><span class="p">)</span>

<span class="n">approx_pdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">e_range</span> <span class="o">-</span> <span class="n">e0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">precision_e_np</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">e_range</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">llike_vec</span><span class="p">)),</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Likelihood&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">e_range</span><span class="p">),</span><span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">approx_pdf</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;FM approx&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="nailed-it">
<h3>Nailed it<a class="headerlink" href="#nailed-it" title="Permalink to this heading">#</a></h3>
<p>As one can see from the plot above, we have managed to cheaply compute how well we expect to measure the EMRI parameters. This is very useful, it can take days, if not weeks to run full Bayesian inference on EMRIs. Hence, to scope out the LISA science of EMRIs, Fisher matrices can be used to cheaply understand how well one can measure parameters of various astrophysical scenarios.</p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="exercise-5">
<h1>Exercise 5<a class="headerlink" href="#exercise-5" title="Permalink to this heading">#</a></h1>
<p>Using the Fisher matrix formalism, try to understand how well we can measure the primary mass <span class="math notranslate nohighlight">\(M\)</span> for the EMRI given above. If you get bored, try and investigate the other parameters as well.</p>
<p>Using the Fisher matrix, prove that the fisher information on the distance can be written as</p>
<div class="math notranslate nohighlight">
\[
\Gamma_{d_{L}d_{L}} = \frac{\rho^{2}}{d_{L}^{2}}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\rho^{2} = (h|h)\)</span> is the optimal matched-filtering SNR. Then verify that, indeed, we can measure <span class="math notranslate nohighlight">\(\Delta d_{L} = d_{L}/\rho.\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># dM = 1e-1  # Set step size for numerical derivative</span>

<span class="c1"># wave_p = few_gen([INSERT CODE HERE])</span>
<span class="c1"># wave_m = few_gen([INSERT CODE HERE])</span>

<span class="c1"># deriv_wave = [INSERT CODE HERE]</span>

<span class="c1"># deriv_wave_fft = xp.fft.rfft(deriv_wave)</span>

<span class="c1"># gamma_MM = inner_product(deriv_wave.real,deriv_wave.real,dt)  # Just a scalar</span>

<span class="c1"># precision_M = [INSERT CODE HERE]</span>

<span class="c1"># print(&quot;Precision we can expect to measure the primary mass is&quot;, precision_M)</span>

<span class="c1"># Analytical solution present at the bottom of this notebook ;)</span>
</pre></div>
</div>
</div>
</div>
<section id="time-frequency-domain">
<h2>Time-Frequency Domain<a class="headerlink" href="#time-frequency-domain" title="Permalink to this heading">#</a></h2>
<p>So far we have analysed EMRIs in a specific domain: the time-domain. This is just one type of window in which to view the world of EMRIs. It may be more instructive to analyse EMRIs in other types of domains, such as the time-frequency or purely the frequency domain. In the cells that follow, we will plot a spectrogram of EMRIs to truly show the rich harmonic structure offered by this awesome sources.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">9.55</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>  <span class="c1"># polar viewing angle in source frame</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>  <span class="c1"># azimuthal viewing angle in source frame</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">10.0</span>

<span class="n">wave</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># Generate our source</span>
<span class="n">wave_np</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span>
<span class="c1"># short fourier transform of the signal</span>
<span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">Zxx</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">stft</span><span class="p">(</span><span class="n">wave_np</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">dt</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Zxx</span><span class="p">)),</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;gouraud&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cb</span><span class="p">,)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;STFT Magnitude&#39;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency [Hz]&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [Years]&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="exercise-6">
<h3>Exercise 6<a class="headerlink" href="#exercise-6" title="Permalink to this heading">#</a></h3>
<p>In the previous plot the different harmonics of the waveform can be recognized as tracks in time-frequency space. As exercise, try to plot the frequency tracks as a function of time on top of the previous plot. Take the same input parameters and run a trajectory to obtain the <code class="docutils literal notranslate"><span class="pre">p</span></code> and <code class="docutils literal notranslate"><span class="pre">e</span></code> evolution. Then pass these arrays into the the function <code class="docutils literal notranslate"><span class="pre">get_fundamental_frequencies</span></code> and obtain the three fundamental frequencies. Then convert to the correct units and plot the frequency <span class="math notranslate nohighlight">\(f=(m \Omega_\varphi + n \Omega_r)/(2\pi)\)</span> for some values of your choice for <span class="math notranslate nohighlight">\(m\)</span> and <span class="math notranslate nohighlight">\(n\)</span>. See if you can identify some tracks yourself.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">9.55</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>  <span class="c1"># polar viewing angle in source frame</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>  <span class="c1"># azimuthal viewing angle in source frame</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">10.0</span>

<span class="n">wave</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">wave_np</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>

<span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">Zxx</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">stft</span><span class="p">(</span><span class="n">wave_np</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">dt</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>

<span class="n">time</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">,</span> <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
<span class="n">OmegaPhi</span><span class="p">,</span> <span class="n">OmegaTheta</span><span class="p">,</span> <span class="n">OmegaR</span> <span class="o">=</span> <span class="n">get_fundamental_frequencies</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fharmonics_phi</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">*</span><span class="n">OmegaPhi</span> <span class="o">/</span> <span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">MTSUN_SI</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)]</span>
<span class="c1"># fharmonics_r = [n*OmegaR / (M*MTSUN_SI) / (np.pi*2) for n in range(1,10)]</span>

<span class="n">m</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">f_combo_r_phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">OmegaPhi</span> <span class="o">+</span> <span class="n">n</span><span class="o">*</span><span class="n">OmegaR</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">MTSUN_SI</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Zxx</span><span class="p">)),</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;gouraud&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">fharmonics_phi</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="c1">#     plt.plot(time,fharmonics_r[j],&#39;white&#39;, linestyle=&#39;--&#39;)\</span>
<span class="c1">#     plt.plot(time,f_combo_r_phi, c = &#39;red&#39;, linestyle = &#39;--&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cb</span><span class="p">,)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;STFT Magnitude&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency [Hz]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [sec]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="frequency-domain-emri-waveform">
<h1>Frequency domain EMRI waveform<a class="headerlink" href="#frequency-domain-emri-waveform" title="Permalink to this heading">#</a></h1>
<p>In the cells above, we focused on EMRIs in the time-frequency domain. In the cells that follow we will introduce a new waveform model <a class="reference external" href="https://arxiv.org/abs/2307.12585">recently published</a>, which is a pure frequency domain EMRI waveform model.</p>
<p>We begin by setting up two classes. The first <code class="docutils literal notranslate"><span class="pre">fd_gen</span></code> stands for <strong>frequency domain generator</strong> and <code class="docutils literal notranslate"><span class="pre">td_gen</span></code> stands for, you guessed it, <strong>time domain generator</strong>. We are also pushing for GPUs to be used here so we can analyse full analysis length signals (<span class="math notranslate nohighlight">\(\geq\)</span> 1 years).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># frequency domain</span>
<span class="n">fd_gen</span> <span class="o">=</span> <span class="n">GenerateEMRIWaveform</span><span class="p">(</span>
    <span class="s2">&quot;FastSchwarzschildEccentricFlux&quot;</span><span class="p">,</span>
    <span class="n">sum_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">pad_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="s2">&quot;fd&quot;</span><span class="p">,</span> <span class="n">odd_len</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">return_list</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">use_gpu</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># time domain</span>
<span class="n">td_gen</span> <span class="o">=</span> <span class="n">GenerateEMRIWaveform</span><span class="p">(</span>
    <span class="s2">&quot;FastSchwarzschildEccentricFlux&quot;</span><span class="p">,</span>
    <span class="n">sum_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">pad_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">odd_len</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">return_list</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">use_gpu</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the EMRI parameters</span>

<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">9.6</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>  <span class="c1"># polar viewing angle in source frame</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>  <span class="c1"># azimuthal viewing angle in source frame</span>

<span class="n">x_I</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># will be ignored in Schwarzschild waveform</span>

<span class="n">qK</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>  <span class="c1"># polar spin angle</span>
<span class="n">phiK</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>  <span class="c1"># azimuthal viewing angle</span>
<span class="n">qS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>  <span class="c1"># polar sky angle</span>
<span class="n">phiS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>  <span class="c1"># azimuthal viewing angle</span>

<span class="n">dist</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># distance</span>
<span class="c1"># initial phases</span>

<span class="n">Phi_phi0</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Phi_theta0</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">Phi_r0</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">Tobs</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># observation time, if the inspiral is shorter, the it will be zero padded</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1"># time interval</span>

<span class="n">waveform_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;T&quot;</span><span class="p">:</span> <span class="n">Tobs</span><span class="p">,</span>
    <span class="s2">&quot;dt&quot;</span><span class="p">:</span> <span class="n">dt</span><span class="p">,</span>
    <span class="s2">&quot;eps&quot;</span><span class="p">:</span> <span class="mf">1e-6</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="pure-time-domain">
<h1>Pure time domain<a class="headerlink" href="#pure-time-domain" title="Permalink to this heading">#</a></h1>
<p>Let’s now generate a waveform in the time domain and convert to the frequency domain through the <code class="docutils literal notranslate"><span class="pre">fft</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First let&#39;s try to generate a full year long EMRI waveform in the time domain and look at the periodigram</span>
<span class="n">hp_td</span><span class="p">,</span> <span class="n">hx_td</span> <span class="o">=</span> <span class="n">td_gen</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">x_I</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">qK</span><span class="p">,</span> <span class="n">phiK</span><span class="p">,</span> <span class="n">qS</span><span class="p">,</span> <span class="n">phiS</span><span class="p">,</span> <span class="n">Phi_phi0</span><span class="p">,</span> <span class="n">Phi_theta0</span><span class="p">,</span> <span class="n">Phi_r0</span><span class="p">,</span> <span class="o">**</span><span class="n">waveform_kwargs</span><span class="p">)</span>

<span class="n">t_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Tobs</span><span class="o">*</span><span class="n">YRSID_SI</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>
<span class="n">N_t</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hp_td</span><span class="p">)</span>

<span class="n">freq_bin_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfftfreq</span><span class="p">(</span><span class="n">N_t</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

<span class="n">hp_fft</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">hp_td</span><span class="p">)</span>
<span class="n">hp_fft_np</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">hp_fft</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_range</span><span class="o">/</span><span class="mi">60</span><span class="o">/</span><span class="mi">60</span><span class="o">/</span><span class="mi">24</span><span class="p">,</span><span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">hp_td</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Time [days]&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$h_</span><span class="si">{p}</span><span class="s1">(t)$&#39;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Time domain&#39;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">freq_bin_np</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="nb">abs</span><span class="p">(</span><span class="n">hp_fft_np</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">1e-5</span><span class="p">,</span><span class="mf">1e-1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Frequency [Hz]&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$|h_</span><span class="si">{p}</span><span class="s1">(f)|^2$&#39;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Frequency domain&#39;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="pure-frequency-domain">
<h2>Pure frequency domain<a class="headerlink" href="#pure-frequency-domain" title="Permalink to this heading">#</a></h2>
<p>Now let’s generate the waveform directly in the frequency domain and compare to the fft’d time-domain variate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hp_fd</span><span class="p">,</span> <span class="n">hx_fd</span> <span class="o">=</span> <span class="n">fd_gen</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">x_I</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">qK</span><span class="p">,</span> <span class="n">phiK</span><span class="p">,</span> <span class="n">qS</span><span class="p">,</span> <span class="n">phiS</span><span class="p">,</span> <span class="n">Phi_phi0</span><span class="p">,</span> <span class="n">Phi_theta0</span><span class="p">,</span> <span class="n">Phi_r0</span><span class="p">,</span> <span class="o">**</span><span class="n">waveform_kwargs</span><span class="p">)</span>
<span class="n">hp_fd_np</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">hp_fd</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">freqs</span> <span class="o">=</span> <span class="n">fd_gen</span><span class="o">.</span><span class="n">waveform_generator</span><span class="o">.</span><span class="n">create_waveform</span><span class="o">.</span><span class="n">frequency</span>
<span class="n">freqs_np</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">freqs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">freqs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">freq_bin_np</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dt</span> <span class="o">*</span> <span class="n">hp_fft_np</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;TD into FD&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">freqs_np</span><span class="p">[</span><span class="n">N_t</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:],</span> <span class="nb">abs</span><span class="p">(</span><span class="n">hp_fd_np</span><span class="p">[</span><span class="n">N_t</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;pure FD&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mf">1e-5</span><span class="p">,</span><span class="mf">1e-1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequencies [Hz]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Periodigram $|\tilde</span><span class="si">{h}</span><span class="s1">(f)|^2$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Comparison between waveform models&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">inner_product_FD</span><span class="p">(</span><span class="n">a_f</span><span class="p">,</span><span class="n">b_f</span><span class="p">,</span><span class="n">df</span><span class="p">,</span> <span class="n">PSD</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">xp</span><span class="o">.</span><span class="n">real</span> <span class="p">(</span> <span class="n">xp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">xp</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">a_f</span><span class="p">)</span> <span class="o">*</span> <span class="n">b_f</span> <span class="o">*</span> <span class="n">df</span> <span class="o">/</span> <span class="n">PSD</span><span class="p">)</span> <span class="p">)</span>

<span class="n">PSD_cp</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">PowerSpectralDensity</span><span class="p">(</span><span class="n">freqs_np</span><span class="p">[</span><span class="n">N_t</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]))</span>

<span class="n">SNR2_FD_model</span> <span class="o">=</span> <span class="n">inner_product_FD</span><span class="p">(</span><span class="n">hp_fd</span><span class="p">[</span><span class="n">N_t</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">hp_fd</span><span class="p">[</span><span class="n">N_t</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">df</span><span class="p">,</span> <span class="n">PSD_cp</span><span class="p">)</span>
<span class="n">SNR2_TD_model</span> <span class="o">=</span> <span class="n">inner_product_FD</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="n">hp_fft</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">dt</span><span class="o">*</span><span class="n">hp_fft</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">df</span><span class="p">,</span> <span class="n">PSD_cp</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Approximate SNR of the system using frequency domain model&quot;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">SNR2_FD_model</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Approximate SNR of the system using time domain model&quot;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">SNR2_TD_model</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Not bad.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-7">
<h2>Exercise 7<a class="headerlink" href="#exercise-7" title="Permalink to this heading">#</a></h2>
<p>Now using the overlap function defined by</p>
<div class="math notranslate nohighlight">
\[ \mathcal{O}(a,b) = \frac{(a|b)}{\sqrt{(a|a)(b|b)}}, \ \ \text{with inner product:} \ \ (a|b) = 4\int_{0}^{\infty}\frac{\tilde{a}(f)\tilde{b}^{\star}(f)}{S_{n}(f)}\]</div>
<p>try and show that the two waveform models <code class="docutils literal notranslate"><span class="pre">fd_gen</span></code> and <code class="docutils literal notranslate"><span class="pre">td_gen</span></code> are near equivalent for the parameters given above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your turn!</span>

<span class="c1"># ab = inner_product_FD([INSERT YOUR CODE HERE])</span>
<span class="c1"># aa = inner_product_FD(hp_fd[N_t//2 + 1:], hp_fd[N_t//2 + 1:], df, PSD_cp)</span>
<span class="c1"># bb = inner_product_FD(dt * hp_fft[1:], dt * hp_fft[1:], df, PSD_cp)</span>

<span class="c1"># overlap = [INSERT YOUR CODE HERE]</span>

<span class="c1"># print(&quot;Overlap between two models is = &quot;, overlap)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="end-of-tutorial-well-done">
<h1>End of Tutorial… Well done!<a class="headerlink" href="#end-of-tutorial-well-done" title="Permalink to this heading">#</a></h1>
<p>Congratulations! You should now know the basics of EMRI waveform modelling. For an EMRI, you should now be able to generate a trajectory and an associated snapshot waveform!</p>
<p>We have just skimmed the surface of the <code class="docutils literal notranslate"><span class="pre">FastEMRIWaveforms</span></code> package though. The waveforms we have generated have been specific to eccentric inspirals of point particles into non-rotating black holes. Below we discuss a (very approximate) generic orbit waveform interface that generates waveforms for generic orbits into rotating black holes.</p>
<p>The rest of the material is optional. However, if you are keen and continue to have questions after this tutorial, feel free to email me or Lorenzo.</p>
<p><a class="reference external" href="mailto:ollie&#46;burke&#37;&#52;&#48;l2it&#46;in2p3&#46;fr">ollie<span>&#46;</span>burke<span>&#64;</span>l2it<span>&#46;</span>in2p3<span>&#46;</span>fr</a></p>
<p><a class="reference external" href="mailto:lorenzo&#46;speri&#37;&#52;&#48;aei&#46;mpg&#46;de">lorenzo<span>&#46;</span>speri<span>&#64;</span>aei<span>&#46;</span>mpg<span>&#46;</span>de</a></p>
<section id="extra-material-augmented-analytic-kludge-with-5pn-trajectory">
<h2>Extra Material: Augmented Analytic Kludge with 5PN trajectory<a class="headerlink" href="#extra-material-augmented-analytic-kludge-with-5pn-trajectory" title="Permalink to this heading">#</a></h2>
<p>We have now implemented a new version of the Augmented Analytic Kludge with 5PN trajectories.</p>
<p>Waveforms are generated based on the Augmented Analytic Kludge given in the <a class="reference external" href="https://github.com/alvincjk/EMRI_Kludge_Suite/">EMRI Kludge Suite</a>. However, here the trajectory is vastly improved by employing the 5PN fluxes for generic Kerr orbits from <a class="reference external" href="https://arxiv.org/abs/2008.13554">Fujita &amp; Shibata (2020)</a>.</p>
<p>The 5PN trajectory produces orbital and phase trajectories. The trajectory is calculated until the orbit reaches within 0.2 of the separatrix, determined from <a class="reference external" href="https://arxiv.org/abs/1912.07609/">Stein and Warburton (2020)</a>. The
fundamental frequencies along the trajectory at each point are then calculated from the orbital parameters and the spin value given by <a class="reference external" href="https://arxiv.org/abs/gr-qc/0202090%3E">Schmidt (2002)</a>.</p>
<p>These frequencies along the trajectory are then used to map to the frequency basis of the <a class="reference external" href="https://arxiv.org/abs/gr-qc/0310125">Analytic Kludge</a>. This mapping takes the form of time evolving large mass and spin parameters, as
well as the use of phases and frequencies in <span class="math notranslate nohighlight">\(\alpha, \Phi, \gamma\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\Phi = \Phi_\phi,
\]</div>
<div class="math notranslate nohighlight">
\[
\gamma = \Phi_\phi + \Phi_\theta
\]</div>
<div class="math notranslate nohighlight">
\[
\alpha = \Phi_\phi + \Phi_\theta + \Phi_r.
\]</div>
<p>The frequencies in that basis are found by taking the time derivatives
of each equation above.</p>
<p><strong>Please note:</strong> the 5PN trajectory and AAK waveform take the parameter <span class="math notranslate nohighlight">\(Y\equiv\cos{\iota}=L/\sqrt{L^2 + Q}\)</span> rather than <span class="math notranslate nohighlight">\(x_I\)</span> as is accepted for relativistic waveforms and in the generic waveform interface discussed above. The generic waveform interface directly converts <span class="math notranslate nohighlight">\(x_I\)</span> to <span class="math notranslate nohighlight">\(Y\)</span>.</p>
<p>This class has GPU capabilities and works from the sparse trajectory methodoligy with cubic spine interpolation of the smoothly varying waveform quantities. This waveform does not have the freedom in terms of user-chosen quantitites that
<code class="docutils literal notranslate"><span class="pre">few.waveform.SchwarzschildEccentricWaveformBase</span></code> contains. This is mainly due to the specific waveform constructions particular to the AAK/AK.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">use_gpu</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># keyword arguments for inspiral generator (RunKerrGenericPn5Inspiral)</span>
<span class="n">inspiral_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;DENSE_STEPPING&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># we want a sparsely sampled trajectory</span>
    <span class="s2">&quot;max_init_len&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e3</span><span class="p">),</span>  <span class="c1"># all of the trajectories will be well under len = 1000</span>
<span class="p">}</span>

<span class="c1"># keyword arguments for summation generator (AAKSummation)</span>
<span class="n">sum_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;use_gpu&quot;</span><span class="p">:</span> <span class="n">use_gpu</span><span class="p">,</span>  <span class="c1"># GPU is available for this type of summation</span>
    <span class="s2">&quot;pad_output&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">wave_generator</span> <span class="o">=</span> <span class="n">Pn5AAKWaveform</span><span class="p">(</span><span class="n">inspiral_kwargs</span><span class="o">=</span><span class="n">inspiral_kwargs</span><span class="p">,</span> <span class="n">sum_kwargs</span><span class="o">=</span><span class="n">sum_kwargs</span><span class="p">,</span> <span class="n">use_gpu</span><span class="o">=</span><span class="n">use_gpu</span><span class="p">)</span>

<span class="c1"># set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">14.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.6</span>
<span class="n">iota0</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">Y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">iota0</span><span class="p">)</span>
<span class="n">Phi_phi0</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">Phi_theta0</span> <span class="o">=</span> <span class="mf">1.2</span>
<span class="n">Phi_r0</span> <span class="o">=</span> <span class="mf">0.8</span>


<span class="n">qS</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">phiS</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">qK</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="n">phiK</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="n">dist</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">mich</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">15.0</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">2.0</span>

<span class="n">waveform</span> <span class="o">=</span> <span class="n">wave_generator</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">Y0</span><span class="p">,</span> <span class="n">qS</span><span class="p">,</span> <span class="n">phiS</span><span class="p">,</span> <span class="n">qK</span><span class="p">,</span> <span class="n">phiK</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span>
                          <span class="n">Phi_phi0</span><span class="o">=</span><span class="n">Phi_phi0</span><span class="p">,</span> <span class="n">Phi_theta0</span><span class="o">=</span><span class="n">Phi_theta0</span><span class="p">,</span> <span class="n">Phi_r0</span><span class="o">=</span><span class="n">Phi_r0</span><span class="p">,</span> <span class="n">mich</span><span class="o">=</span><span class="n">mich</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>

<span class="n">waveform_real_np</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">waveform</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">waveform_imag_np</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">waveform</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">waveform</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">waveform_real_np</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">waveform_imag_np</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can also assume a long-wavelength LISA response by setting <code class="docutils literal notranslate"><span class="pre">mich=True</span></code>. Please note this is not Time-delay interferometry (TDI).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">waveform_lw_cp</span> <span class="o">=</span> <span class="n">wave_generator</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">Y0</span><span class="p">,</span> <span class="n">qS</span><span class="p">,</span> <span class="n">phiS</span><span class="p">,</span> <span class="n">qK</span><span class="p">,</span> <span class="n">phiK</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">mich</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
<span class="n">waveform_lw_real_np</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">waveform_lw_cp</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">waveform_lw_imag_np</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">waveform_lw_cp</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">waveform_lw_cp</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">waveform_lw_real_np</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">waveform_lw_imag_np</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="pn-trajectory">
<h3>5PN Trajectory<a class="headerlink" href="#pn-trajectory" title="Permalink to this heading">#</a></h3>
<p>This new waveform includes 5PN trajectories from <a class="reference external" href="https://arxiv.org/abs/2008.13554">Fujita &amp; Shibata 2020</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialize trajectory class</span>
<span class="n">traj</span> <span class="o">=</span> <span class="n">EMRIInspiral</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="s2">&quot;pn5&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e5</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">14.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.7</span>
<span class="n">iota0</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">Y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">iota0</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">Phi_phi0</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">Phi_theta0</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">Phi_r0</span> <span class="o">=</span> <span class="mf">3.0</span>


<span class="c1"># run trajectory</span>
<span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_r</span><span class="p">,</span> <span class="n">Phi_theta</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">Y0</span><span class="p">,</span>
                                             <span class="n">Phi_phi0</span><span class="o">=</span><span class="n">Phi_phi0</span><span class="p">,</span> <span class="n">Phi_theta0</span><span class="o">=</span><span class="n">Phi_theta0</span><span class="p">,</span> <span class="n">Phi_r0</span><span class="o">=</span><span class="n">Phi_r0</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">p</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$e$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$p$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$e$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$Y$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Phi_\phi$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Phi_r$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Phi_\theta$&#39;</span><span class="p">]</span>
<span class="n">xlabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$p$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">]</span>
<span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_r</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">]</span>
<span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xlab</span><span class="p">,</span> <span class="n">ylab</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">xlabels</span><span class="p">,</span> <span class="n">ylabels</span><span class="p">)):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlab</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylab</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>With the PN trajectory, we need to be careful at smaller <span class="math notranslate nohighlight">\(p\)</span>, larger <span class="math notranslate nohighlight">\(a\)</span>, and larger <span class="math notranslate nohighlight">\(e\)</span>. This trajectory can exihibt pathological behavior near these extremes. Therefore, we provide the option to truncate the trajectory at the Schwarzschild (<span class="math notranslate nohighlight">\(a=0\)</span>) separatrix, <span class="math notranslate nohighlight">\(6 + 2e\)</span>. To do this, you provide the keyword <code class="docutils literal notranslate"><span class="pre">enforce_schwarz_sep=True</span></code> to the initialization of the class.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialize trajectory class</span>
<span class="n">traj</span> <span class="o">=</span> <span class="n">EMRIInspiral</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="s2">&quot;pn5&quot;</span><span class="p">,</span> <span class="n">enforce_schwarz_sep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e5</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">14.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.7</span>
<span class="n">iota0</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">Y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">iota0</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">Phi_phi0</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">Phi_theta0</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">Phi_r0</span> <span class="o">=</span> <span class="mf">3.0</span>


<span class="c1"># run trajectory</span>
<span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_r</span><span class="p">,</span> <span class="n">Phi_theta</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">Y0</span><span class="p">,</span>
                                             <span class="n">Phi_phi0</span><span class="o">=</span><span class="n">Phi_phi0</span><span class="p">,</span> <span class="n">Phi_theta0</span><span class="o">=</span><span class="n">Phi_theta0</span><span class="p">,</span> <span class="n">Phi_r0</span><span class="o">=</span><span class="n">Phi_r0</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">p</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$e$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$p$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$e$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$Y$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Phi_\phi$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Phi_r$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Phi_\theta$&#39;</span><span class="p">]</span>
<span class="n">xlabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$p$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">]</span>
<span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_r</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">]</span>
<span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xlab</span><span class="p">,</span> <span class="n">ylab</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">xlabels</span><span class="p">,</span> <span class="n">ylabels</span><span class="p">)):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlab</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylab</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="generating-the-new-aak-with-the-generic-waveform-generator">
<h3>Generating the new AAK with the generic waveform generator<a class="headerlink" href="#generating-the-new-aak-with-the-generic-waveform-generator" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gen_wave</span> <span class="o">=</span> <span class="n">GenerateEMRIWaveform</span><span class="p">(</span><span class="s2">&quot;Pn5AAKWaveform&quot;</span><span class="p">,</span> <span class="n">use_gpu</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># parameters</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">0.01</span>  <span class="c1"># years</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">15.0</span>  <span class="c1"># seconds</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">12.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mf">0.6</span>  <span class="c1"># notice this is x_I, not Y. The AAK waveform can convert to Y.</span>
<span class="n">qK</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># polar spin angle</span>
<span class="n">phiK</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># azimuthal viewing angle</span>
<span class="n">qS</span> <span class="o">=</span> <span class="mf">0.3</span>  <span class="c1"># polar sky angle</span>
<span class="n">phiS</span> <span class="o">=</span> <span class="mf">0.3</span>  <span class="c1"># azimuthal viewing angle</span>
<span class="n">dist</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># distance</span>
<span class="n">Phi_phi0</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">Phi_theta0</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">Phi_r0</span> <span class="o">=</span> <span class="mf">3.0</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">gen_wave</span><span class="p">(</span>
    <span class="n">M</span><span class="p">,</span>
    <span class="n">mu</span><span class="p">,</span>
    <span class="n">a</span><span class="p">,</span>
    <span class="n">p0</span><span class="p">,</span>
    <span class="n">e0</span><span class="p">,</span>
    <span class="n">x0</span><span class="p">,</span>
    <span class="n">dist</span><span class="p">,</span>
    <span class="n">qS</span><span class="p">,</span>
    <span class="n">phiS</span><span class="p">,</span>
    <span class="n">qK</span><span class="p">,</span>
    <span class="n">phiK</span><span class="p">,</span>
    <span class="n">Phi_phi0</span><span class="p">,</span>
    <span class="n">Phi_theta0</span><span class="p">,</span>
    <span class="n">Phi_r0</span><span class="p">,</span>
    <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="n">dt</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">real</span><span class="p">[:</span><span class="mi">2000</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="mode-selection-for-schwarszchild-waveforms">
<h2>Mode Selection for Schwarszchild Waveforms<a class="headerlink" href="#mode-selection-for-schwarszchild-waveforms" title="Permalink to this heading">#</a></h2>
<p>The mode selection module is paramount to the computational efficiency of this model. Below we show how we perform this selection operation by moving from a set of amplitudes to only those that contribute.</p>
<section id="mode-selection-by-power-contribution">
<h3>Mode selection by power contribution<a class="headerlink" href="#mode-selection-by-power-contribution" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># first, lets get amplitudes for a trajectory</span>
<span class="n">traj</span> <span class="o">=</span> <span class="n">EMRIInspiral</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="s2">&quot;SchwarzEccFlux&quot;</span><span class="p">)</span>

<span class="c1"># parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e5</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.7</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">3.</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span>

<span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">,</span> <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

<span class="c1"># get amplitudes along trajectory</span>
<span class="n">amp</span> <span class="o">=</span> <span class="n">RomanAmplitude</span><span class="p">()</span>

<span class="n">teuk_modes</span> <span class="o">=</span> <span class="n">amp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

<span class="c1"># get ylms</span>
<span class="n">ylms</span> <span class="o">=</span> <span class="n">ylm_gen</span><span class="p">(</span><span class="n">amp</span><span class="o">.</span><span class="n">unique_l</span><span class="p">,</span> <span class="n">amp</span><span class="o">.</span><span class="n">unique_m</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">amp</span><span class="o">.</span><span class="n">inverse_lm</span><span class="p">]</span>

<span class="c1"># select modes</span>

<span class="n">mode_selector</span> <span class="o">=</span> <span class="n">ModeSelector</span><span class="p">(</span><span class="n">amp</span><span class="o">.</span><span class="n">m0mask</span><span class="p">,</span> <span class="n">use_gpu</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-5</span>  <span class="c1"># tolerance on mode contribution to total power</span>

<span class="n">modeinds</span> <span class="o">=</span> <span class="p">[</span><span class="n">amp</span><span class="o">.</span><span class="n">l_arr</span><span class="p">,</span> <span class="n">amp</span><span class="o">.</span><span class="n">m_arr</span><span class="p">,</span> <span class="n">amp</span><span class="o">.</span><span class="n">n_arr</span><span class="p">]</span>
<span class="p">(</span><span class="n">teuk_modes_in</span><span class="p">,</span> <span class="n">ylms_in</span><span class="p">,</span> <span class="n">ls</span><span class="p">,</span> <span class="n">ms</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span> <span class="o">=</span> <span class="n">mode_selector</span><span class="p">(</span><span class="n">teuk_modes</span><span class="p">,</span> <span class="n">ylms</span><span class="p">,</span> <span class="n">modeinds</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;We reduced the mode content from </span><span class="si">{}</span><span class="s2"> modes to </span><span class="si">{}</span><span class="s2"> modes.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">teuk_modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">teuk_modes_in</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="specific-mode-selection">
<h3>Specific mode selection<a class="headerlink" href="#specific-mode-selection" title="Permalink to this heading">#</a></h3>
<p>The user can also select a specific set of modes to use in the waveform.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># l = 2, m = 2 wave</span>
<span class="n">specific_modes</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">)]</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">dist</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">wave_22</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">mode_selection</span><span class="o">=</span><span class="n">specific_modes</span><span class="p">)</span>
<span class="n">wave_base</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_22</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mismatch with full wave:&#39;</span><span class="p">,</span> <span class="n">get_mismatch</span><span class="p">(</span><span class="n">wave_22</span><span class="p">,</span> <span class="n">wave_base</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="producing-waveforms-with-the-generic-interface">
<h3>Producing waveforms with the generic interface<a class="headerlink" href="#producing-waveforms-with-the-generic-interface" title="Permalink to this heading">#</a></h3>
<p>Waveforms can also be generated through a generic interface (<a class="reference external" href="https://mikekatz04.github.io/FastEMRIWaveforms/html/index.html#few.waveform.GenerateEMRIWaveform">GenerateEMRIWaveform</a>) where the specific waveform model is chosen with an argument. This can also be used to produce waveforms in the detector frame used for data analysis. This interface includes all EMRI parameters, including spin and inclination, as well as sky and orientation parameters. When a specific waveform model does not require certain parameters, the parameters will not affect the waveform generation. A detector-frame waveform in this case means <span class="math notranslate nohighlight">\(h_+,h_x\)</span> in the SSB-frame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gen_wave</span> <span class="o">=</span> <span class="n">GenerateEMRIWaveform</span><span class="p">(</span><span class="s2">&quot;FastSchwarzschildEccentricFlux&quot;</span><span class="p">,</span> <span class="n">use_gpu</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">T</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">30</span><span class="o">/</span><span class="mi">24</span>  <span class="c1"># years</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">15.0</span>  <span class="c1"># seconds</span>

<span class="c1"># parameters</span>
<span class="c1"># intrinsic</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># will be ignored in Schwarzschild waveform</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">12.0</span> <span class="c1"># in range [6+2*e0, 16]</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="c1">#</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># will be ignored in Schwarzschild waveform</span>

<span class="c1"># extrinsic</span>
<span class="n">qK</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># polar spin angle</span>
<span class="n">phiK</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># azimuthal viewing angle</span>
<span class="n">qS</span> <span class="o">=</span> <span class="mf">0.3</span>  <span class="c1"># polar sky angle</span>
<span class="n">phiS</span> <span class="o">=</span> <span class="mf">0.4</span>  <span class="c1"># azimuthal viewing angle</span>
<span class="n">dist</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># distance</span>

<span class="c1"># initial phases</span>
<span class="n">Phi_phi0</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">Phi_theta0</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">Phi_r0</span> <span class="o">=</span> <span class="mf">3.0</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">gen_wave</span><span class="p">(</span>
    <span class="n">M</span><span class="p">,</span>
    <span class="n">mu</span><span class="p">,</span>
    <span class="n">a</span><span class="p">,</span>
    <span class="n">p0</span><span class="p">,</span>
    <span class="n">e0</span><span class="p">,</span>
    <span class="n">x0</span><span class="p">,</span>
    <span class="n">dist</span><span class="p">,</span>
    <span class="n">qS</span><span class="p">,</span>
    <span class="n">phiS</span><span class="p">,</span>
    <span class="n">qK</span><span class="p">,</span>
    <span class="n">phiK</span><span class="p">,</span>
    <span class="n">Phi_phi0</span><span class="p">,</span>
    <span class="n">Phi_theta0</span><span class="p">,</span>
    <span class="n">Phi_r0</span><span class="p">,</span>
    <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Time duration </span><span class="si">{</span><span class="n">T</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1"> years&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">real</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$h_+$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">imag</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$-h_\times$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t [seconds]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="mf">4.0</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">gen_wave</span><span class="p">(</span>
    <span class="n">M</span><span class="p">,</span>
    <span class="n">mu</span><span class="p">,</span>
    <span class="n">a</span><span class="p">,</span>
    <span class="n">p0</span><span class="p">,</span>
    <span class="n">e0</span><span class="p">,</span>
    <span class="n">x0</span><span class="p">,</span>
    <span class="n">dist</span><span class="p">,</span>
    <span class="n">qS</span><span class="p">,</span>
    <span class="n">phiS</span><span class="p">,</span>
    <span class="n">qK</span><span class="p">,</span>
    <span class="n">phiK</span><span class="p">,</span>
    <span class="n">Phi_phi0</span><span class="p">,</span>
    <span class="n">Phi_theta0</span><span class="p">,</span>
    <span class="n">Phi_r0</span><span class="p">,</span>
    <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Time duration </span><span class="si">{</span><span class="n">T</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1"> years&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">real</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$h_+$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">imag</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$-h_\times$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t [seconds]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="scaling-of-the-waveform-with-the-central-black-hole-mass">
<h2>Scaling of the waveform with the central black hole mass<a class="headerlink" href="#scaling-of-the-waveform-with-the-central-black-hole-mass" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">dt</span><span class="o">=</span><span class="mi">10</span>
<span class="n">max_FFT</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="mi">10</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span><span class="mf">6.5</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="mf">1e-5</span><span class="o">*</span><span class="n">M</span>
    <span class="n">Tnew</span> <span class="o">=</span> <span class="n">T</span><span class="o">*</span><span class="n">M</span><span class="o">/</span><span class="mf">1e6</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">gen_wave</span><span class="p">(</span>
        <span class="n">M</span><span class="p">,</span>
        <span class="n">mu</span><span class="p">,</span>
        <span class="n">a</span><span class="p">,</span>
        <span class="n">p0</span><span class="p">,</span>
        <span class="n">e0</span><span class="p">,</span>
        <span class="n">x0</span><span class="p">,</span>
        <span class="n">dist</span><span class="p">,</span>
        <span class="n">qS</span><span class="p">,</span>
        <span class="n">phiS</span><span class="p">,</span>
        <span class="n">qK</span><span class="p">,</span>
        <span class="n">phiK</span><span class="p">,</span>
        <span class="n">Phi_phi0</span><span class="p">,</span>
        <span class="n">Phi_theta0</span><span class="p">,</span>
        <span class="n">Phi_r0</span><span class="p">,</span>
        <span class="n">T</span><span class="o">=</span><span class="n">Tnew</span><span class="p">,</span>
        <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,)</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>


    <span class="n">FFT</span><span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span> <span class="o">/</span> <span class="n">Tnew</span> <span class="o">/</span><span class="n">mu</span>
    <span class="n">f</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dt</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">M</span><span class="o">*</span><span class="n">MTSUN_SI</span><span class="p">,</span> <span class="n">xp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">FFT</span><span class="p">)),</span> <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$h_+$, M=</span><span class="si">{</span><span class="n">M</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1">, Tinsp=</span><span class="si">{</span><span class="n">Tnew</span><span class="si">:</span><span class="s1">.1e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">max_FFT</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">FFT</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">max_FFT</span><span class="p">)</span>
<span class="c1">#     plt.plot(t, h.imag, label=r&#39;$-h_\times$&#39;)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Time duration </span><span class="si">{</span><span class="n">T</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1"> years&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\frac{\tilde</span><span class="si">{h}</span><span class="s1">}{\mu \, Tinsp}$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$f \, M$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="citing-waveforms-and-modules">
<h2>Citing waveforms and modules<a class="headerlink" href="#citing-waveforms-and-modules" title="Permalink to this heading">#</a></h2>
<p>If you use any work from this package please cite our papers <a class="reference external" href="https://arxiv.org/abs/2104.04582">arxiv.org/2104.04582</a> and <a class="reference external" href="https://arxiv.org/abs/2008.06071">arxiv.org/2008.06071</a>. Additionally please cite any additional work for each module used by calling the <code class="docutils literal notranslate"><span class="pre">citation</span></code> attribute on the module class:</p>
<section id="fast-schwarzschild-eccentric-waveforms">
<h3>Fast Schwarzschild Eccentric Waveforms<a class="headerlink" href="#fast-schwarzschild-eccentric-waveforms" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wave</span> <span class="o">=</span> <span class="n">FastSchwarzschildEccentricFlux</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">citation</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="new-and-improved-aak-with-5pn-trajectory">
<h3>New and Improved AAK with 5PN Trajectory<a class="headerlink" href="#new-and-improved-aak-with-5pn-trajectory" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wave_aak</span> <span class="o">=</span> <span class="n">Pn5AAKWaveform</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">wave_aak</span><span class="o">.</span><span class="n">citation</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="solutions">
<h1>Solutions<a class="headerlink" href="#solutions" title="Permalink to this heading">#</a></h1>
<section id="id2">
<h2>Exercise 0<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>For the default parameters <span class="math notranslate nohighlight">\((M,\mu,a,p_{0},e_{0},(x_{I})_{0}) = (10^{6}, 10, 0, 10, 0.3, 1)\)</span> with <span class="math notranslate nohighlight">\(T = 2\)</span> years, verify that the final point in semi-latus rectum corresponds to the separatrix defined by <span class="math notranslate nohighlight">\(p = 6 + 2e\)</span>. Change the time of evolution <span class="math notranslate nohighlight">\(T\)</span> and make a note of what you find.</p></li>
<li><p>Modify the mass-ratio of the system above by increasing/decreasing <span class="math notranslate nohighlight">\(M\)</span> whilst keeping <span class="math notranslate nohighlight">\(\mu\)</span> (and all other parameters) fixed. What do you observe about the orbital evolution in semi-latus rectum <span class="math notranslate nohighlight">\(p(t)\)</span>? You may need to increase the time of evolution <span class="math notranslate nohighlight">\(T\)</span>. You will find that <span class="math notranslate nohighlight">\(\dot{p} = dp/dt\)</span> decreases as <span class="math notranslate nohighlight">\(M\)</span> is increased.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># EXERCISE 0!</span>

<span class="c1">#set initial parameters for Schwarzschild orbit</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>   <span class="c1"># Primary mass  (solar masses)</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>  <span class="c1"># Secondary mass  (solar masses)</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1"># range [separatrix, 45]</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span>  <span class="c1"># range [0.0, 0.7]</span>

<span class="c1"># run trajectory</span>
<span class="c1"># must include for generic inputs, will fix a = 0 and x = 1.0</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1"># additional information</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="c1"># initial time step,</span>
              <span class="n">T</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="c1"># Time duration in years</span>
              <span class="n">err</span><span class="o">=</span><span class="mf">1e-10</span> <span class="c1"># integrator error -- used as a tolerance to solve coupled ODEs above</span>
             <span class="p">)</span>

<span class="c1"># Compute trajectory of smaller body: p(t), e(t), xI(t), Phi_phi(t), Phi_theta(t), Phi_r(t)</span>
<span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">xI</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">,</span> <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
                                              <span class="n">Phi_phi0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_theta0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_r0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="n">p_sep</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">e</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># SOLUTION PART</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Separatrix is at &quot;</span><span class="p">,</span><span class="n">p_sep</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Final point in semi-latus rectum is&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Compute trajectory of smaller body: p(t), e(t), xI(t), Phi_phi(t), Phi_theta(t), Phi_r(t)</span>

<span class="n">M_vec</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">N_plots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">M_vec</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N_plots</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">i</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="n">M_vec</span><span class="p">:</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">xI</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">,</span> <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
                                              <span class="n">Phi_phi0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_theta0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="n">Phi_r0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mi">60</span><span class="o">/</span><span class="mi">60</span><span class="o">/</span><span class="mi">24</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;M = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">M</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;time [days]&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;semi-latus rectum $p$&#39;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Primary mass = </span><span class="si">{}</span><span class="s1"> $M_\odot$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">M</span><span class="p">),</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>


    <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id3">
<h2>Exercise 1<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h2>
<p>Let us now understand how the inspiral duration changes for different initial eccentricity or different initial semi-latus rectum. Remember the range of validity of the parameters and produce two plots:</p>
<ol class="arabic simple">
<li><p>Time duration vs initial eccentricity (fixing all the other parameters)</p></li>
<li><p>Time duration vs initial semi-latus rectum (fixing all the other parameters)</p></li>
</ol>
<p>If you have time, produce also this plot:</p>
<ol class="arabic simple" start="3">
<li><p>Time duration vs M/epsilon (M=Mass MBHS and epsilon=Mass ratio). Prove that, for different total masses and mass ratios, the behavior of Time duration vs M/epsilon is always the same (Hint: use two for loops, one for <span class="math notranslate nohighlight">\(M\)</span> and the other for <span class="math notranslate nohighlight">\(\epsilon\)</span>).</p></li>
</ol>
<p>You should find that:</p>
<ol class="arabic simple">
<li><p>The relation between time-duration and eccentricity is weak</p></li>
<li><p>The relation between time-duration and semi-latus rectum is near-linear</p></li>
<li><p>The relation between time-duration and <span class="math notranslate nohighlight">\(M/\epsilon\)</span> is perfectly linear.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## # set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1"># range [separatrix, 45]</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c1"># range [0.0, 0.7]</span>

<span class="c1"># run trajectory</span>
<span class="c1"># must include for generic inputs, will fix a = 0 and x = 1.0</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>


<span class="c1"># Fix time duration to a very large number (100 years) so that we obtain the time duration from trajectory</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="c1"># initial time setp,</span>
              <span class="n">T</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">,</span>
              <span class="n">err</span><span class="o">=</span><span class="mf">1e-10</span> <span class="c1"># integrator error</span>
             <span class="p">)</span>

<span class="n">ecc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">tfinal</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">e0</span> <span class="ow">in</span> <span class="n">ecc</span><span class="p">:</span>

    <span class="c1"># get secondary mass for fixed mass ratio</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">xI</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">,</span> <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
                                                  <span class="n">Phi_phi0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                                  <span class="n">Phi_theta0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                                  <span class="n">Phi_r0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                                  <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">tfinal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecc</span><span class="p">,</span> <span class="n">tfinal</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Time duration [years]&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$e_</span><span class="si">{0}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1">############################</span>
<span class="n">tfinal</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># reset eccentricity</span>
<span class="n">pp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">7.0</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">for</span> <span class="n">p0</span> <span class="ow">in</span> <span class="n">pp</span><span class="p">:</span>

    <span class="c1"># get secondary mass for fixed mass ratio</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">xI</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">,</span> <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
                                                  <span class="n">Phi_phi0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                                  <span class="n">Phi_theta0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                                  <span class="n">Phi_r0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                                  <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">tfinal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="n">tfinal</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Time duration [years]&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$p_</span><span class="si">{0}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">############################</span>
<span class="n">tfinal</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="c1"># reset</span>
<span class="n">p0</span><span class="o">=</span><span class="mf">10.0</span>
<span class="n">mass_ratio_vector</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.0</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">Mvec</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="n">Mvec</span><span class="p">:</span>
    <span class="n">tfinal</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">epsilon</span> <span class="ow">in</span> <span class="n">mass_ratio_vector</span><span class="p">:</span>

        <span class="c1"># get secondary mass for fixed mass ratio</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">M</span> <span class="o">*</span> <span class="n">epsilon</span>
        <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">xI</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">,</span> <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
                                                      <span class="n">Phi_phi0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                                      <span class="n">Phi_theta0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                                      <span class="n">Phi_r0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                                      <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># inspiral duration (divide by YRSID_SI to get it in years)</span>
        <span class="n">tfinal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">YRSID_SI</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">M</span><span class="o">/</span><span class="n">mass_ratio_vector</span><span class="p">,</span> <span class="n">tfinal</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Time duration [years]&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$M/\epsilon$&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id4">
<h2>Exercise 2<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h2>
<p>Plot the FINAL number of cycles (<code class="docutils literal notranslate"><span class="pre">Ncycle.append(Phi_phi[-1]/(2*np.pi))</span></code>) for different mass ratios.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>

<span class="c1"># run trajectory</span>
<span class="c1"># must include for generic inputs, will fix a = 0 and x = 1.0</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1"># range [separatrix, 45]</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c1"># range [0.0, 0.7]</span>

<span class="n">Ncycle</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">epsilon</span> <span class="ow">in</span> <span class="n">mass_ratio_vector</span><span class="p">:</span>

    <span class="c1"># get secondary mass for fixed mass ratio</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">M</span> <span class="o">*</span> <span class="n">epsilon</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">xI</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">,</span> <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
                                                  <span class="n">Phi_phi0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                                  <span class="n">Phi_theta0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                                  <span class="n">Phi_r0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                                  <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">Ncycle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Phi_phi</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">mass_ratio_vector</span><span class="p">,</span> <span class="n">Ncycle</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of cycles&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Mass ratio&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id5">
<h2>Exercise 3<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.63</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>  <span class="c1"># polar viewing angle in source frame</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>  <span class="c1"># azimuthal viewing angle in source frame</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">10.0</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">dd</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">SNR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">inner_product</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span><span class="o">+</span><span class="n">inner_product</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">wave</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">dt</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">dd</span><span class="p">,</span> <span class="n">SNR</span><span class="p">,</span><span class="s1">&#39;k.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$1/d_</span><span class="si">{L}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\rho$&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">100.0</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span> <span class="mf">0.05</span><span class="p">)</span>
    <span class="n">SNR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">inner_product</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span><span class="o">+</span><span class="n">inner_product</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">wave</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">dt</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">SNR</span><span class="p">,</span><span class="s1">&#39;k.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mu$&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\rho$&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id6">
<h2>Exercise 4<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e2</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">12.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>  <span class="c1"># polar viewing angle in source frame</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>  <span class="c1"># azimuthal viewing angle in source frame</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;inferno&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">\delta e$&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Overlap&#39;</span><span class="p">)</span>
<span class="n">vec</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">logd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span>

<span class="n">T</span><span class="o">=</span><span class="mf">0.01</span>
<span class="n">base_sig</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
<span class="c1"># M</span>
<span class="n">O</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">delta</span> <span class="ow">in</span> <span class="n">vec</span><span class="p">:</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">delta</span><span class="p">),</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
    <span class="n">O</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">overlap</span><span class="p">(</span><span class="n">base_sig</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">dt</span><span class="p">))</span>

<span class="n">axs</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">logd</span><span class="p">,</span> <span class="n">O</span> <span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>

<span class="c1"># mu</span>
<span class="n">O</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">delta</span> <span class="ow">in</span> <span class="n">vec</span><span class="p">:</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">delta</span><span class="p">),</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
    <span class="n">O</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">overlap</span><span class="p">(</span><span class="n">base_sig</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">dt</span><span class="p">))</span>

<span class="n">axs</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">logd</span><span class="p">,</span> <span class="n">O</span> <span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mu&#39;</span><span class="p">)</span>

<span class="c1"># p0</span>
<span class="n">O</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">delta</span> <span class="ow">in</span> <span class="n">vec</span><span class="p">:</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">delta</span><span class="p">),</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
    <span class="n">O</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">overlap</span><span class="p">(</span><span class="n">base_sig</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">dt</span><span class="p">))</span>

<span class="n">axs</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">logd</span><span class="p">,</span> <span class="n">O</span> <span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;p0&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id7">
<h2>Exercise 5<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h2>
<p>Using the Fisher matrix formalism, try to understand how well we can measure the primary mass <span class="math notranslate nohighlight">\(M\)</span> for the EMRI given above.</p>
<p>Using the Fisher matrix, prove that the fisher information on the distance can be written as</p>
<div class="math notranslate nohighlight">
\[
\Gamma_{d_{L}d_{L}} = \frac{\rho^{2}}{d_{L}^{2}}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\rho^{2} = (h|h)\)</span> is the optimal matched-filtering SNR. Then verify that, indeed, we can measure <span class="math notranslate nohighlight">\(\Delta d_{L} = d_{L}/\rho\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Code</span>

<span class="n">dM</span> <span class="o">=</span> <span class="mf">1e-1</span>  <span class="c1"># Set step size for numerical derivative</span>

<span class="n">wave_p</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="n">dM</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">wave_m</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span> <span class="o">-</span> <span class="n">dM</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">deriv_wave</span> <span class="o">=</span> <span class="p">(</span><span class="n">wave_p</span> <span class="o">-</span> <span class="n">wave_m</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dM</span><span class="p">)</span>

<span class="n">deriv_wave_fft</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">deriv_wave</span><span class="p">)</span>

<span class="n">gamma_MM</span> <span class="o">=</span> <span class="n">inner_product</span><span class="p">(</span><span class="n">deriv_wave</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">deriv_wave</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>  <span class="c1"># Just a scalar</span>

<span class="n">precision_M</span> <span class="o">=</span> <span class="n">gamma_MM</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Precision we can expect to measure the primary mass is&quot;</span><span class="p">,</span> <span class="n">precision_M</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="analytical-solution">
<h1>Analytical solution<a class="headerlink" href="#analytical-solution" title="Permalink to this heading">#</a></h1>
<p>We need to calculate</p>
<div class="math notranslate nohighlight">
\[\Gamma_{d_{L}d_{L}} = 4\mathcal{R}\int_{0}^{\infty} \frac{1}{S_{n}(f)}\rvert \partial_{d_{L}}\tilde{h}\rvert^{2} df.\]</div>
<p>Notice that since <span class="math notranslate nohighlight">\(\tilde{h}(f) \sim 1/d_{L}\)</span>, we have that <span class="math notranslate nohighlight">\(\partial_{d_{L}}\tilde{h}(f) \sim -\frac{1}{d_{L}^2}\)</span>. We thus have that
$<span class="math notranslate nohighlight">\( \partial_{d_{L}}\tilde{h}(f) = -\frac{1}{d_{L}}\tilde{h}(f) \Longrightarrow |\partial_{d_{L}}\tilde{h}(f)|^2 = \left(\frac{1}{d_{L}}\right)^2 |\tilde{h}(f)|^2 \)</span><span class="math notranslate nohighlight">\( This implies that
\)</span><span class="math notranslate nohighlight">\( \Gamma_{d_{L}d_{L}} = 4\mathcal{R}\int_{0}^{\infty} \frac{1}{S_{n}(f)}\big\rvert \partial_{d_{L}}\tilde{h}\big\rvert^{2} df = \left(\frac{1}{d_{L}}\right)^2 \cdot 4\mathcal{R}\int_{0}^{\infty} \frac{1}{S_{n}(f)}\big\rvert \tilde{h}(f)\big\rvert^{2} df = \left(\frac{(h|h)}{d_{L}}\right)^2 = \frac{\rho^2}{d_{L}^2}\)</span>$</p>
<p>The result then follows that <span class="math notranslate nohighlight">\(\Delta d_{L} = (\Gamma^{-1}_{d_{L}d_{L}})^{1/2} = \frac{d_{L}}{\rho} \)</span> as required.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id8">
<h1>Exercise 6<a class="headerlink" href="#id8" title="Permalink to this heading">#</a></h1>
<p>In the previous plot the different harmonics of the waveform can be recognized as tracks in time-frequency space. As exercise, try to plot the frequency tracks as a function of time on top of the previous plot. Take the same input parameters and run a trajectory to obtain the <code class="docutils literal notranslate"><span class="pre">p</span></code> and <code class="docutils literal notranslate"><span class="pre">e</span></code> evolution. Then pass these arrays into the the function <code class="docutils literal notranslate"><span class="pre">get_fundamental_frequencies</span></code> and obtain the three fundamental frequencies. Then convert to the correct units and plot the frequency <span class="math notranslate nohighlight">\(f=(m \Omega_\varphi + n \Omega_r)/(2\pi)\)</span> for some values of your choice for <span class="math notranslate nohighlight">\(m\)</span> and <span class="math notranslate nohighlight">\(n\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e2</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">12.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>  <span class="c1"># polar viewing angle in source frame</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>  <span class="c1"># azimuthal viewing angle in source frame</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">10.0</span>

<span class="n">wave</span> <span class="o">=</span> <span class="n">few_gen</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">Zxx</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">stft</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">dt</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>

<span class="n">time</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">,</span> <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
<span class="n">OmegaPhi</span><span class="p">,</span> <span class="n">OmegaTheta</span><span class="p">,</span> <span class="n">OmegaR</span> <span class="o">=</span> <span class="n">get_fundamental_frequencies</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">fharmonic</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">OmegaPhi</span> <span class="o">/</span> <span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">MTSUN_SI</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Zxx</span><span class="p">)),</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;gouraud&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">fharmonic</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cb</span><span class="p">,)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;STFT Magnitude&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency [Hz]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [sec]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="id9">
<h2>Exercise 7<a class="headerlink" href="#id9" title="Permalink to this heading">#</a></h2>
<p>Now using the overlap function defined by</p>
<div class="math notranslate nohighlight">
\[ \mathcal{O}(a,b) = \frac{(a|b)}{\sqrt{(a|a)(b|b)}}, \ \ \text{with inner product:} \ \ (a|b) = 4\int_{0}^{\infty}\frac{\tilde{a}(f)\tilde{b}^{\star}(f)}{S_{n}(f)}\]</div>
<p>try and show that the two waveform models <code class="docutils literal notranslate"><span class="pre">fd_gen</span></code> and <code class="docutils literal notranslate"><span class="pre">td_gen</span></code> are near equivalent for the parameters given above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ab</span> <span class="o">=</span> <span class="n">inner_product_FD</span><span class="p">(</span><span class="n">hp_fd</span><span class="p">[</span><span class="n">N_t</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">hp_fft</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">df</span><span class="p">,</span> <span class="n">PSD_cp</span><span class="p">)</span>
<span class="n">aa</span> <span class="o">=</span> <span class="n">inner_product_FD</span><span class="p">(</span><span class="n">hp_fd</span><span class="p">[</span><span class="n">N_t</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">hp_fd</span><span class="p">[</span><span class="n">N_t</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">df</span><span class="p">,</span> <span class="n">PSD_cp</span><span class="p">)</span>
<span class="n">bb</span> <span class="o">=</span> <span class="n">inner_product_FD</span><span class="p">(</span><span class="n">dt</span> <span class="o">*</span> <span class="n">hp_fft</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">hp_fft</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">df</span><span class="p">,</span> <span class="n">PSD_cp</span><span class="p">)</span>

<span class="n">overlap</span> <span class="o">=</span> <span class="n">ab</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">aa</span><span class="o">*</span><span class="n">bb</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Overlap between two models is = &quot;</span><span class="p">,</span> <span class="n">overlap</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./book"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> 
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">EMRI Waveforms in a nutshell</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#authors">Authors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-an-extreme-mass-ratio-inspiral">What is an Extreme Mass Ratio Inspiral?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#emri-waveforms">EMRI Waveforms</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#each-harmonic-is-characterized-by-three-important-functions">Each harmonic is characterized by three important functions:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#general-remarks">General Remarks</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#emri-parameter-space">EMRI Parameter space</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#schwarzschild-eccentric-trajectories-and-waveforms">Schwarzschild Eccentric Trajectories and Waveforms</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#trajectory-module">Trajectory Module</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-us-begin-by-analysing-a-basic-trajectory">Let us begin by analysing a basic trajectory</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-0">Exercise 0</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#quasi-keplerian-parameters-p-e">Quasi-Keplerian parameters: <span class="math notranslate nohighlight">\((p,e)\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#evolution-of-semi-latus-rectum-and-eccentricity">Evolution of semi-latus rectum and eccentricity</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#trajectory-duration-as-a-function-of-mass-ratio-eccentricity-semi-latus-rectum">Trajectory duration as a function of mass ratio, eccentricity, semi-latus rectum</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion-of-plot-above">Discussion of plot above</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1">Exercise 1</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-cycles-and-differences-between-trajectories">Number of cycles and differences between trajectories</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2">Exercise 2</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fundamental-frequencies-and-harmonics">Fundamental frequencies and harmonics</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#schwarzchild-waveforms-in-the-source-frame">Schwarzchild Waveforms in the source frame</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#time-domain-representation-of-waveforms">Time Domain Representation of Waveforms</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gpu-acceleration">GPU acceleration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#emri-waveforms-in-different-domains">EMRI Waveforms in different domains</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-full-signal">The full signal</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-exercise">Optional Exercise</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fourier-domain-signal-to-noise-ratio-and-overlaps">Fourier Domain, Signal to noise ratio and Overlaps.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3">Exercise 3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-4">Exercise 4</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reflection">Reflection</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#precision-of-emri-parameters">Precision of EMRI Parameters</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-likelihood-function">The Likelihood Function</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Reflection</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cheap-way-to-estimate-precision-in-parameters-fisher-matrix">Cheap way to estimate precision in parameters: Fisher Matrix</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nailed-it">Nailed it</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-5">Exercise 5</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#time-frequency-domain">Time-Frequency Domain</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-6">Exercise 6</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#frequency-domain-emri-waveform">Frequency domain EMRI waveform</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#pure-time-domain">Pure time domain</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pure-frequency-domain">Pure frequency domain</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-7">Exercise 7</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#end-of-tutorial-well-done">End of Tutorial… Well done!</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extra-material-augmented-analytic-kludge-with-5pn-trajectory">Extra Material: Augmented Analytic Kludge with 5PN trajectory</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pn-trajectory">5PN Trajectory</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-the-new-aak-with-the-generic-waveform-generator">Generating the new AAK with the generic waveform generator</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mode-selection-for-schwarszchild-waveforms">Mode Selection for Schwarszchild Waveforms</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mode-selection-by-power-contribution">Mode selection by power contribution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specific-mode-selection">Specific mode selection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#producing-waveforms-with-the-generic-interface">Producing waveforms with the generic interface</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scaling-of-the-waveform-with-the-central-black-hole-mass">Scaling of the waveform with the central black hole mass</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citing-waveforms-and-modules">Citing waveforms and modules</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fast-schwarzschild-eccentric-waveforms">Fast Schwarzschild Eccentric Waveforms</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#new-and-improved-aak-with-5pn-trajectory">New and Improved AAK with 5PN Trajectory</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#solutions">Solutions</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Exercise 0</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Exercise 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Exercise 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Exercise 3</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Exercise 4</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Exercise 5</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analytical-solution">Analytical solution</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Exercise 6</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Exercise 7</a></li>
</ul>
</li>
</ul>

  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/book/Auckland_Tutorial_GPU.ipynb">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.2.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.14.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>